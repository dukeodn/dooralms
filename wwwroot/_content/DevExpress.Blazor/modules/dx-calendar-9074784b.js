import{d as e}from"./dom-e194973c.js";import{D as t}from"./dx-html-element-base-22366177.js";import{C as s}from"./css-classes-f3f8ed66.js";import{_ as r}from"./_tslib-6e8ca86b.js";import{H as n,D as i,L as a,a as o,b as l,c as d}from"./dx-html-element-pointer-events-helper-e822ee39.js";import{S as c}from"./single-slot-element-base-9006911a.js";import{b as h}from"./constants-a68d01b4.js";import{e as u}from"./property-d3853089.js";import{R as m}from"./layouthelper-2d7ade10.js";import{C as y}from"./custom-events-helper-e7f279d3.js";import{K as g,a as D}from"./dx-keyboard-navigator-c333dad6.js";import{k as p}from"./key-758f2153.js";import"./browser-d96520d8.js";import"./data-qa-utils-8be7c726.js";import"./eventhelper-8570b930.js";import"./constants-58283e53.js";import"./devices-9f03a976.js";import"./dx-ui-element-cb17a135.js";import"./lit-element-base-7a85dca5.js";import"./lit-element-70cf14f4.js";import"./logicaltreehelper-60b7eecb.js";import"./point-e4ec110e.js";import"./focus-utils-24f244e4.js";import"./touch-abb6941f.js";import"./disposable-d2c2d283.js";import"./dom-utils-55c8e5bb.js";class f{}var v,C;f.MainElement=s.Prefix+"-calendar",f.SelectedItem=f.MainElement+"-selected-item",f.SelectedRange=f.MainElement+"-selected-range",f.Header=f.MainElement+"-header",f.Content=f.MainElement+"-content",f.Footer=f.MainElement+"-footer",f.WeekRow=f.MainElement+"-week-row",f.YearRow=f.MainElement+"-year-row",f.DecadeRow=f.MainElement+"-decade-row",f.CenturyRow=f.MainElement+"-century-row",f.Day=f.MainElement+"-day",f.NotCurrentView=f.MainElement+"-not-current-view",f.HeaderHelper=f.MainElement+"-header",f.HeaderTitleButton=f.HeaderHelper+"-title-btn",f.HeaderPreviousYearButton=f.HeaderHelper+"-previous-year-btn",f.HeaderPreviousMonthButton=f.HeaderHelper+"-previous-month-btn",f.HeaderPreviousPeriodButton=f.HeaderHelper+"-previous-period-btn",f.HeaderNextYearButton=f.HeaderHelper+"-next-year-btn",f.HeaderNextMonthButton=f.HeaderHelper+"-next-month-btn",f.HeaderNextPeriodButton=f.HeaderHelper+"-next-period-btn",function(e){e.class="class",e.view="view",e.viewDate="view-date",e.enableMultiSelect="enable-multi-select"}(v||(v={})),function(e){e.dataDate="data-date",e.dataMonth="data-month",e.dataYear="data-year",e.dataDecade="data-decade"}(C||(C={}));const I="dxbl-calendar-table-container",w=new Date(new Date(Date.UTC(1,0,1)).setUTCFullYear(1)),b=new Date(Date.UTC(9999,11,31)),S=864e5;class E{constructor(e){this._pointerDownDate=e.pointerDownDate,this._pointerUpDate=null,this._clearSelection=e.clearSelection,this.dayCellElements=e.dayCellElements,this.refreshUI(!1)}get clearSelection(){return this._clearSelection}get pointerDownDate(){return this._pointerDownDate}get pointerUpDate(){return this._pointerUpDate}set pointerUpDate(e){this._pointerUpDate!==e&&e&&(this._pointerUpDate=e,this.refreshUI(!0))}get isValid(){return!!this._pointerUpDate}stop(){this.refreshUI(!1)}cancel(){for(let e=0;e<this.dayCellElements.length;e++){const t=this.dayCellElements[e];E.removeDayCellSelectedClasses(t),t.hasAttribute("data-selected")&&E.addSelectedClassesToCell(t)}}refreshUI(t){const s=this.getStartPointedDateRange(),r=this.getEndPointedDateRange();for(let n=0;n<this.dayCellElements.length;n++){const i=this.dayCellElements[n];if(this.isDateCellDisabled(i))continue;const a=Number(i.dataset.date);E.removeDayCellSelectedClasses(i),t&&this.isDateRangeBoundary(a,s,r)&&e.DomUtils.addClassName(i,f.SelectedRange),this.needApplySelectedStyle(a,s,r,t)&&E.addSelectedClassesToCell(i),i.hasAttribute("data-selected")&&!this.clearSelection&&E.addSelectedClassesToCell(i)}}getStartPointedDateRange(){return this.pointerUpDate?Math.min(this.pointerUpDate.getTime(),this.pointerDownDate.getTime()):this.pointerDownDate.getTime()}getEndPointedDateRange(){return this.pointerUpDate?Math.max(this.pointerUpDate.getTime(),this.pointerDownDate.getTime()):this.pointerDownDate.getTime()}needApplySelectedStyle(e,t,s,r){return!(e<t||e>s)&&(!r||!this.isDateRangeBoundary(e,t,s))}isDateRangeBoundary(e,t,s){if(!this.isDateDisabled(e)&&(e===t||e===s))return!0;return!(!(e>t&&e<s)||e!==this.getBoundaryDate(t,e)&&e!==this.getBoundaryDate(s,e))}getBoundaryDate(e,t){const s=e<t,r=s?1:-1;let n=e;for(;(s?n<t:n>t)&&this.isDateDisabled(n);)n+=r*S;return n}isDateCellDisabled(e){return e.hasAttribute("data-disabled")}isDateDisabled(e){const t=this.getDayCellByDay(e);return null!=t&&this.isDateCellDisabled(t)}getDayCellByDay(e){for(let t=0;t<this.dayCellElements.length;t++)if(this.dayCellElements[t].getAttribute(C.dataDate)===e.toString())return this.dayCellElements[t];return null}static addSelectedClassesToCell(t){e.DomUtils.addClassName(t,f.SelectedItem)}static removeDayCellSelectedClasses(t){e.DomUtils.removeClassName(t,f.SelectedItem),e.DomUtils.removeClassName(t,f.SelectedRange),e.DomUtils.removeClassName(t,"text-white")}}class T{constructor(e,t){this._pointerDownDate=e,this._pointerUpDate=null,this._clearSelection=t}get clearSelection(){return this._clearSelection}get pointerDownDate(){return this._pointerDownDate}get pointerUpDate(){return this._pointerUpDate}set pointerUpDate(e){this._pointerUpDate=e}get isValid(){var e;return this.pointerDownDate.getTime()===(null===(e=this.pointerUpDate)||void 0===e?void 0:e.getTime())}stop(){}cancel(){}}var x,M,F,P;!function(e){e[e.PreviousYear=0]="PreviousYear",e[e.PreviousMonth=1]="PreviousMonth",e[e.Title=2]="Title",e[e.NextMonth=3]="NextMonth",e[e.NextYear=4]="NextYear",e[e.PreviousPeriod=5]="PreviousPeriod",e[e.NextPeriod=6]="NextPeriod"}(x||(x={})),function(e){e[e.Header=0]="Header",e[e.DataTable=1]="DataTable",e[e.Footer=2]="Footer"}(M||(M={})),function(e){e[e.Month=0]="Month",e[e.Year=1]="Year",e[e.Decade=2]="Decade",e[e.Century=3]="Century"}(F||(F={})),function(e){e[e.January=0]="January",e[e.February=1]="February",e[e.March=2]="March",e[e.April=3]="April",e[e.May=4]="May",e[e.June=5]="June",e[e.July=6]="July",e[e.August=7]="August",e[e.September=8]="September",e[e.October=9]="October",e[e.November=10]="November",e[e.December=11]="December"}(P||(P={}));class B extends c{constructor(){super(),this._handlePointerEventsMode=n.None,this.viewDate=new Date,this.viewType=F.Month,this._pointerEventsHelper=new i(this)}get calendar(){return this._calendar||(this._calendar=e.DomUtils.getParentByTagName(this,h)),this._calendar}connectedCallback(){super.connectedCallback(),this._pointerEventsHelper.initialize()}disconnectedCallback(){super.disconnectedCallback(),this._pointerEventsHelper.dispose()}updated(e){e.has("viewDate")&&this.calendar.restoreFocus(),e.has("viewType")&&(this._handlePointerEventsMode=n.None,this.viewType===F.Month&&(this.calendar.fixCalendarTableSize(),this._handlePointerEventsMode=n.Click|n.Dragging,this.calendar.restoreFocus())),super.updated(e)}get handlePointerEventsMode(){return this._handlePointerEventsMode}get handlePointerEventsTarget(){return this}get handlePointerEventsDelay(){return a}get hoverTitleElementsSelector(){return null}}r([u({attribute:v.viewDate,converter:e=>new Date(Number(e))})],B.prototype,"viewDate",void 0),r([u({type:Number,attribute:v.view})],B.prototype,"viewType",void 0);class N extends CustomEvent{constructor(e,t,s){super(N.eventName,{detail:new K(e,t,s),bubbles:!0,composed:!0,cancelable:!0})}}N.eventName=h+".daycellpointerup";class K{constructor(e,t,s){this.PointerDownDate=e,this.PointerUpDate=t,this.ClearSelection=s}}y.register(N.eventName,(e=>e.detail));class R extends g{constructor(e,t){super(e.getKeyboardNavigator(),t),this.calendar=e}isFocusedFromOutside(){return this.calendar.isSameNode(document.activeElement)}isDateEarlierThanFirstAccessible(e){return e instanceof Date?e<w:!(e.hasAttribute(C.dataDate)&&!isNaN(parseInt(e.getAttribute(C.dataDate))))||G.getDateFromCell(e)<w}isDateLaterThanLastAccessible(e){return e instanceof Date?e>b:!(e.hasAttribute(C.dataDate)&&!isNaN(parseInt(e.getAttribute(C.dataDate))))||G.getDateFromCell(e)>b}isDateOutOfBoundaries(e,t,s){const r=G.getDateRelativeTo(e,t,s);return this.isDateEarlierThanFirstAccessible(r)||this.isDateLaterThanLastAccessible(r)}}class H extends R{constructor(e,t){super(e,t),this.itemSelector=`:scope > .${s.Button}:not(.${s.Disabled})`,this.buttonClassToButtonType=new Map([[f.HeaderPreviousYearButton,x.PreviousYear],[f.HeaderPreviousMonthButton,x.PreviousMonth],[f.HeaderPreviousPeriodButton,x.PreviousPeriod],[f.HeaderTitleButton,x.Title],[f.HeaderNextYearButton,x.NextYear],[f.HeaderNextMonthButton,x.NextMonth],[f.HeaderNextPeriodButton,x.NextPeriod]]),this.buttonTypeToButtonClass=new Map([[x.PreviousYear,f.HeaderPreviousYearButton],[x.PreviousMonth,f.HeaderPreviousMonthButton],[x.PreviousPeriod,f.HeaderPreviousPeriodButton],[x.Title,f.HeaderTitleButton],[x.NextYear,f.HeaderNextYearButton],[x.NextMonth,f.HeaderNextMonthButton],[x.NextPeriod,f.HeaderNextPeriodButton]])}getShortcutContext(){return{AreaType:M.Header,ButtonType:this.getSelectedButtonType()}}queryItems(){return this.queryItemsBySelector(this.itemSelector)}activate(){const e=this.getButtonIndexByType(this.lastFocusedButtonType);this.selectedItemIndex=this.isFocusedFromOutside()?0:null!=e?e:this.itemCount-1,super.activate()}leaveBackward(){this.lastFocusedButtonType=void 0,super.leaveBackward()}leaveForward(){this.lastFocusedButtonType=void 0,super.leaveForward()}handleKeyDown(e){switch(p.KeyUtils.getEventKeyCode(e)){case p.KeyCode.Tab:return e.shiftKey?this.moveToPrevItem():this.moveToNextItem();case p.KeyCode.Space:case p.KeyCode.Enter:return this.performShortcutEvent(e),!0}return super.handleKeyDown(e)}moveToPrevItem(){return this.selectedItemIndex>0&&(this.selectItem(this.selectedItemIndex-1),!0)}moveToNextItem(){return this.selectedItemIndex<this.itemCount-1&&(this.selectItem(this.selectedItemIndex+1),!0)}selectItem(e){super.selectItem(e),this.lastFocusedButtonType=this.getSelectedButtonType()}getSelectedButtonType(){for(const e of this.selectedItemElement.classList)if(this.buttonClassToButtonType.has(e))return this.buttonClassToButtonType.get(e)}getButtonIndexByType(e){return e?this.items.findIndex((t=>t.classList.contains(this.buttonTypeToButtonClass.get(e)))):void 0}}class O extends R{get isObsolete(){return this.calendar.currentView!==this.currentCalendarView}constructor(e,t){super(e,t),this.boundCalendarFocusedDayChangedHandler=this.onCalendarFocusedDayChanged.bind(this),this.calendar.onFocusedDayChanged(this.boundCalendarFocusedDayChangedHandler)}getShortcutContext(){const e=this.lastShortcutArgs;return delete this.lastShortcutArgs,{AreaType:M.DataTable,CalendarView:null==e?void 0:e.calendarView,Offset:null==e?void 0:e.offset,Row:null==e?void 0:e.row,Column:null==e?void 0:e.column,Date:null==e?void 0:e.date}}queryItems(){return this.queryItemsBySelector(this.itemSelector)}handleKeyDown(e){switch(p.KeyUtils.getEventKeyCode(e)){case p.KeyCode.Left:return!e.ctrlKey&&!e.metaKey&&(this.moveToPrevDay(e),!0);case p.KeyCode.Right:return!e.ctrlKey&&!e.metaKey&&(this.moveToNextDay(e),!0);case p.KeyCode.Up:return!e.ctrlKey&&!e.metaKey&&(this.moveToPrevRow(e),!0);case p.KeyCode.Down:return!e.ctrlKey&&!e.metaKey&&(this.moveToNextRow(e),!0);case p.KeyCode.Home:return this.handleHomeKey(e),!0;case p.KeyCode.End:return this.handleEndKey(e),!0;case p.KeyCode.PageUp:return this.handlePageUpKey(e),!0;case p.KeyCode.PageDown:return this.handlePageDownKey(e),!0;case p.KeyCode.Enter:case p.KeyCode.Space:return this.handleItemClick(e),!0}return super.handleKeyDown(e)}getSelectedItemRowIndex(){return Math.floor(this.selectedItemIndex/this.rowLength)}getSelectedItemColumnIndex(){return Math.floor(this.selectedItemIndex%this.rowLength)}handlePageUpKey(e){this.prepareAndPerformShortcutEvent(e,{calendarView:e.shiftKey?F.Year:F.Month,offset:-1,date:e.shiftKey?G.getDateFromCell(this.selectedItemElement):void 0})}handlePageDownKey(e){this.prepareAndPerformShortcutEvent(e,{calendarView:e.shiftKey?F.Year:F.Month,offset:1,date:e.shiftKey?G.getDateFromCell(this.selectedItemElement):void 0})}prepareAndPerformShortcutEvent(e,t){this.lastShortcutArgs=t,this.performShortcutEvent(e)}onCalendarFocusedDayChanged(e){e&&(this.tryRestoreSelectedItem(e),this.selectItem(this.selectedItemIndex))}}class U extends O{get rowLength(){return 7}get currentCalendarView(){return F.Month}get itemSelector(){return`:scope .${f.WeekRow} > .${f.Day}`}initialize(){var e;super.initialize();const t=null!==(e=this.calendar.focusedCellElement)&&void 0!==e?e:this.targetElement.querySelector(`.${f.SelectedItem}`);t&&this.tryRestoreSelectedItem(t)}moveToPrevDay(e){this.isDateOutOfBoundaries(-1,!0,this.selectedItemElement)||(this.calendar.tryMoveFocus(-1,!0,this.selectedItemElement)?(super.moveToPrevItem(),e.shiftKey&&this.handleItemClick(e)):this.switchCurrentMonth(e,-1))}moveToNextDay(e){this.isDateOutOfBoundaries(1,!0,this.selectedItemElement)||(this.calendar.tryMoveFocus(1,!0,this.selectedItemElement)?(super.moveToNextItem(),e.shiftKey&&this.handleItemClick(e)):this.switchCurrentMonth(e,1))}moveToPrevRow(e){this.isDateOutOfBoundaries(-1,!1,this.selectedItemElement)||(this.calendar.tryMoveFocus(-1,!1,this.selectedItemElement)?(this.selectedItemIndex>=this.rowLength&&this.selectItem(this.selectedItemIndex-this.rowLength),e.shiftKey&&this.handleItemClick(e)):this.switchCurrentMonth(e,-1))}moveToNextRow(e){this.isDateOutOfBoundaries(1,!1,this.selectedItemElement)||(this.calendar.tryMoveFocus(1,!1,this.selectedItemElement)?(this.selectedItemIndex<=this.itemCount-this.rowLength&&this.selectItem(this.selectedItemIndex+this.rowLength),e.shiftKey&&this.handleItemClick(e)):this.switchCurrentMonth(e,1))}handleHomeKey(e){const t=this.getIndexOfFirstAccessibleItemInCurrentRow();this.calendar.tryMoveFocus(t-this.selectedItemIndex,!0,this.selectedItemElement)?(this.selectItem(t),e.shiftKey&&this.handleItemClick(e)):this.switchCurrentMonth(e,-1)}handleEndKey(e){const t=this.getIndexOfLastAccessibleItemInCurrentRow();this.calendar.tryMoveFocus(t-this.selectedItemIndex,!0,this.selectedItemElement)?(this.selectItem(t),e.shiftKey&&this.handleItemClick(e)):this.switchCurrentMonth(e,1)}handlePageUpKey(e){const t=e.shiftKey?G.getYearOffsetInDaysFrom(-1,this.selectedItemElement):G.getMonthOffsetInDaysFrom(-1,this.selectedItemElement);this.isDateOutOfBoundaries(-t,!0,this.selectedItemElement)||this.calendar.tryMoveFocus(-t,!0,this.selectedItemElement)||super.handlePageUpKey(e)}handlePageDownKey(e){const t=e.shiftKey?G.getYearOffsetInDaysFrom(1,this.selectedItemElement):G.getMonthOffsetInDaysFrom(1,this.selectedItemElement);this.isDateOutOfBoundaries(t,!0,this.selectedItemElement)||this.calendar.tryMoveFocus(t,!0,this.selectedItemElement)||super.handlePageDownKey(e)}handleItemClick(e){this.prepareAndPerformShortcutEvent(e,{calendarView:this.currentCalendarView,date:G.getDateFromCell(this.selectedItemElement)})}switchCurrentMonth(e,t){this.prepareAndPerformShortcutEvent(e,{calendarView:this.currentCalendarView,offset:t,date:this.calendar.focusedDate})}getIndexOfFirstAccessibleItemInCurrentRow(){let e=this.getSelectedItemRowIndex()*this.rowLength;for(;e<=this.selectedItemIndex&&this.isDateEarlierThanFirstAccessible(this.getItem(e));)e++;return e}getIndexOfLastAccessibleItemInCurrentRow(){let e=(this.getSelectedItemRowIndex()+1)*this.rowLength-1;for(;e>=this.selectedItemIndex&&this.isDateEarlierThanFirstAccessible(this.getItem(e));)e--;return e}}class Y extends O{get rowLength(){return 4}initialize(){super.initialize();const e=this.targetElement.querySelector(`.${f.SelectedItem}`);e&&this.tryRestoreSelectedItem(e)}moveToPrevDay(e){this.calendar.tryMoveFocus(-1,!0,this.selectedItemElement)?super.moveToPrevItem():this.switchCurrentMonth(e,-1)}moveToNextDay(e){this.calendar.tryMoveFocus(1,!0,this.selectedItemElement)?super.moveToNextItem():this.switchCurrentMonth(e,1)}moveToPrevRow(e){this.calendar.tryMoveFocus(-1,!1,this.selectedItemElement)?this.selectedItemIndex>=this.rowLength&&this.selectItem(this.selectedItemIndex-this.rowLength):this.switchCurrentMonth(e,-1)}moveToNextRow(e){this.calendar.tryMoveFocus(1,!1,this.selectedItemElement)?this.selectedItemIndex<this.itemCount-this.rowLength&&this.selectItem(this.selectedItemIndex+this.rowLength):this.switchCurrentMonth(e,1)}handleHomeKey(e){const t=this.getIndexOfFirstAccessibleItemInCurrentView();this.calendar.tryMoveFocus(t-this.selectedItemIndex,!0,this.selectedItemElement)&&this.selectItem(t)}handleEndKey(e){const t=this.getIndexOfLastAccessibleItemInCurrentView();this.calendar.tryMoveFocus(t-this.selectedItemIndex,!0,this.selectedItemElement)&&this.selectItem(t)}handleItemClick(e){this.prepareAndPerformShortcutEvent(e,{calendarView:this.currentCalendarView,row:this.getSelectedItemRowIndex(),column:this.getSelectedItemColumnIndex()})}switchCurrentMonth(e,t){this.prepareAndPerformShortcutEvent(e,{calendarView:this.currentCalendarView,offset:t})}getIndexOfFirstAccessibleItemInCurrentView(){let e=0;for(;e<=this.selectedItemIndex&&!this.itemBelongsToCurrentView(e);)e++;return e}getIndexOfLastAccessibleItemInCurrentView(){let e=this.itemCount-1;for(;e>=this.selectedItemIndex&&!this.itemBelongsToCurrentView(e);)e--;return e}itemBelongsToCurrentView(e){var t;return!(null===(t=this.getItem(e))||void 0===t?void 0:t.classList.contains(f.NotCurrentView))}}class A extends Y{get currentCalendarView(){return F.Year}get itemSelector(){return`:scope .${f.YearRow} > td`}}class _ extends Y{get currentCalendarView(){return F.Decade}get itemSelector(){return`:scope .${f.DecadeRow} > td:not(.${s.Invisible})`}}class V extends Y{get currentCalendarView(){return F.Century}get itemSelector(){return`:scope .${f.CenturyRow} > td:not(.${s.Invisible})`}}class L extends R{constructor(e,t){super(e,t),this.itemSelector=`:scope > .${s.Button}`}getShortcutContext(){return{AreaType:M.Footer,ButtonType:this.selectedItemIndex}}queryItems(){return this.queryItemsBySelector(this.itemSelector)}activate(){this.selectedItemIndex=this.isFocusedFromOutside()?this.itemCount-1:0,super.activate()}handleKeyDown(e){switch(p.KeyUtils.getEventKeyCode(e)){case p.KeyCode.Tab:return e.shiftKey?this.moveToPrevItem():this.moveToNextItem();case p.KeyCode.Space:case p.KeyCode.Enter:return this.performShortcutEvent(e),!0}return super.handleKeyDown(e)}moveToPrevItem(){return this.selectedItemIndex>0&&(this.selectItem(this.selectedItemIndex-1),!0)}moveToNextItem(){return this.selectedItemIndex<this.itemCount-1&&(this.selectItem(this.selectedItemIndex+1),!0)}}class k extends R{constructor(e){super(e,e)}queryItems(){return new Array(this.getHeader(),this.getDataTableContainer(),this.getFooter())}createItemStrategy(e){if(e===this.getHeader())return new H(this.calendar,e);if(e===this.getDataTableContainer())return this.createDataTableStrategy(e);if(e===this.getFooter())return new L(this.calendar,e);throw new Error("Not implemented")}createDataTableStrategy(e){switch(e.viewType){case F.Month:return new U(this.calendar,e);case F.Year:return new A(this.calendar,e);case F.Decade:return new _(this.calendar,e);case F.Century:return new V(this.calendar,e)}}handleKeyDown(e){const t=p.KeyUtils.getEventKeyCode(e);return t===p.KeyCode.Tab?(e.shiftKey?this.moveToPrevItem():this.moveToNextItem(),!0):!e.ctrlKey||t!==p.KeyCode.Up&&t!==p.KeyCode.Down?super.handleKeyDown(e):(this.performShortcutEvent(e),!0)}moveToPrevItem(){this.selectedItemIndex>0?super.moveToPrevItem():this.leaveBackward()}moveToNextItem(){this.selectedItemIndex<this.itemCount-1?super.moveToNextItem():this.leaveForward()}getHeader(){return this.calendar.getHeaderElement()}getDataTableContainer(){return this.calendar.tableContainer}getFooter(){return this.calendar.getFooterElement()}}class ${get focusedItem(){return this._focusedItem}set focusedItem(e){this._focusedItem=e}get focusedElement(){return this._focusedElement}set focusedElement(e){this._focusedElement=e}get calendar(){return this._calendar}constructor(e){this._calendar=e,this._focusedElement=null}get calendarCurrentViewDate(){return this.calendar.currentViewDate}getUpdatedElementToFocus(){return this.focusedElement=this.findCellElementByItem(this.getUpdatedItemToFocus()),this.focusedElement}findSelectedCellElement(){return this.calendar.querySelector(`td.${f.SelectedItem}`)}}class j extends ${tryMoveFocus(e,t,s){const r=this.getNewRawIndex(e,t,s);return this.focusedItem=this.getNewMonthByRawIndex(r),this.focusedElement=this.findCellElementByItem(this.focusedItem),!this.areMonthsDifferByYear(r)}getUpdatedItemToFocus(){if(void 0===this.focusedItem){const e=this.findSelectedCellElement();this.focusedItem=e?G.getMonthFromCell(e):this.calendarCurrentViewDate.getMonth()}return this.focusedItem}findCellElementByItem(e){return void 0===e?null:this.calendar.querySelector(`td[${C.dataMonth}="${P[e]}"]`)}getNewMonthByRawIndex(e){if(void 0===e)return;return P[P[(e%12+12)%12%12]]}getNewRawIndex(e,t,s){const r=G.getMonthFromCell(s);if(void 0!==r)return r+this.getEffectiveOffset(e,t)}getEffectiveOffset(e,t){return e*(t?1:4)}areMonthsDifferByYear(e){return void 0!==e&&(e<0||e>=12)}}class z extends ${tryMoveFocus(e,t,s){const r=G.getYearFromCell(s);return this.focusedItem=this.getYearRelativeTo(e,t,r),this.focusedElement=this.findCellElementByItem(this.focusedItem),!this.areYearsDifferByDecade(r,this.focusedItem)}getUpdatedItemToFocus(){if(void 0===this.focusedItem){const e=this.findSelectedCellElement();this.focusedItem=e?G.getYearFromCell(e):this.calendarCurrentViewDate.getFullYear()}return this.focusedItem}findCellElementByItem(e){return void 0===e?null:this.calendar.querySelector(`td[${C.dataYear}="${e}"]`)}getYearRelativeTo(e,t,s){if(void 0!==s)return s+this.getEffectiveOffset(e,t)}getEffectiveOffset(e,t){return e*(t?1:4)}areYearsDifferByDecade(e,t){return void 0!==e&&void 0!==t&&Math.floor(e/10)!==Math.floor(t/10)}}class q extends ${tryMoveFocus(e,t,s){this.focusedItem=G.getDateRelativeTo(e,t,s),this.focusedElement=this.findCellElementByItem(this.focusedItem);const r=G.getDateFromCell(s);return!this.areDatesDifferByMonthOrYear(r,this.focusedItem)}getUpdatedItemToFocus(){if(void 0===this.focusedItem){const e=this.findSelectedCellElement();this.focusedItem=e?G.getDateFromCell(e):this.calendarCurrentViewDate}return this.focusedItem}findCellElementByItem(e){return void 0===e?null:this.calendar.querySelector(`.${f.Day}[${C.dataDate}="${e.getTime()}"]`)}areDatesDifferByMonthOrYear(e,t){return e.getMonth()!==t.getMonth()||e.getUTCFullYear()!==t.getUTCFullYear()}}class J extends ${tryMoveFocus(e,t,s){const r=G.getDecadeFromCell(s);return this.focusedItem=this.getDecadeRelativeTo(e,t,r),this.focusedElement=this.findCellElementByItem(this.focusedItem),!this.areDecadesDifferByCentury(r,this.focusedItem)}getUpdatedItemToFocus(){if(void 0===this.focusedItem){const e=this.findSelectedCellElement();this.focusedItem=e?G.getDecadeFromCell(e):this.getCurrentDecade()}return this.focusedItem}findCellElementByItem(e){return void 0===e?null:this.calendar.querySelector(`td[${C.dataDecade}="${e.startYear}-${e.endYear}"]`)}getDecadeRelativeTo(e,t,s){if(void 0===s)return;const r=s.startYear+this.getEffectiveOffset(e,t);return{startYear:r,endYear:r+9}}getEffectiveOffset(e,t){return e*(t?1:4)*10}areDecadesDifferByCentury(e,t){return void 0!==(null==e?void 0:e.startYear)&&void 0!==(null==t?void 0:t.startYear)&&Math.floor(e.startYear/100)!==Math.floor(t.startYear/100)}getCurrentDecade(){const e=this.calendarCurrentViewDate.getFullYear(),t=100*Math.floor(e/100);return{startYear:t,endYear:t+9}}}const W=document.createElement("template");W.innerHTML="\n<style></style>\n<slot />";class G extends t{constructor(){super(),this.boundOnStartDaySelectionHandler=this.onStartDaySelection.bind(this),this.boundOnStopDaySelectionHandler=this.onStopDaySelection.bind(this),this.boundOnCancelDaySelectionHandler=this.onCancelDaySelection.bind(this),this.boundOnDayCellPointerEnterHandler=this.onDayCellPointerEnter.bind(this),this._enableMultiSelect=!1,this._focusedCellElement=null,this._focusStrategies={[F.Month]:new q(this),[F.Year]:new j(this),[F.Decade]:new z(this),[F.Century]:new J(this)},this.daySelectionRenderer=null,this.calendarTableResizeObserver=new ResizeObserver(this.onCalendarTableSizeChanged.bind(this)),this.focusedDayChangedHandlers=[]}get enableMultiSelect(){return this._enableMultiSelect}set enableMultiSelect(e){this._enableMultiSelect=e}get currentViewDate(){return this.tableContainer.viewDate}get currentView(){var e,t;return null!==(t=null===(e=this.tableContainer)||void 0===e?void 0:e.viewType)&&void 0!==t?t:F.Month}get focusedCellElement(){return this._focusedCellElement}set focusedCellElement(e){this._focusedCellElement=e}get focusedDate(){return this._focusStrategies[F.Month].getUpdatedItemToFocus()}get tableContainer(){return this._tableContainer||(this._tableContainer=this.querySelector(`${I}`)),this._tableContainer}connectedCallback(){super.connectedCallback(),this.addEventSubscriptions()}initializeComponent(){super.initializeComponent(),this.fixCalendarTableSize(),this.initializeKeyboardNavigator()}disposeComponent(){this.removeEventSubscriptions(),super.disposeComponent()}disconnectedCallback(){this.calendarTableResizeObserver.disconnect(),super.disconnectedCallback()}fixCalendarTableSize(){if(this.currentView!==F.Month)return;const e=this.getTableElement();if(!e)return;e.style.width="",e.style.height="";const t=e.getBoundingClientRect();m.fromDomRect(t).isEmpty?this.calendarTableResizeObserver.observe(e):this.applyTableSize(e,t.width,t.height)}applyTableSize(e,t,s){e.style.width=t+"px",e.style.height=s+"px"}onCalendarTableSizeChanged(e){if(e.length<1)return;const t=e[0].target,s=e[0].contentRect;m.fromDomRect(s).isEmpty||(this.applyTableSize(t,s.width,s.height),this.calendarTableResizeObserver.disconnect())}addEventSubscriptions(){this.addEventListener(o.eventName,this.boundOnStartDaySelectionHandler),this.addEventListener(l.eventName,this.boundOnStopDaySelectionHandler),this.addEventListener(d.eventName,this.boundOnCancelDaySelectionHandler)}removeEventSubscriptions(){this.removeEventListener(o.eventName,this.boundOnStartDaySelectionHandler),this.removeEventListener(l.eventName,this.boundOnStopDaySelectionHandler),this.removeEventListener(d.eventName,this.boundOnCancelDaySelectionHandler)}addDayCellEventSubscriptions(){const e=this.findDayCellElements();for(let t=0;t<e.length;t++){e[t].addEventListener("pointerenter",this.boundOnDayCellPointerEnterHandler)}}removeDayCellEventSubscriptions(){const e=this.findDayCellElements();for(let t=0;t<e.length;t++){e[t].removeEventListener("pointerenter",this.boundOnDayCellPointerEnterHandler)}}onStartDaySelection(t){if(e.DomUtils.hasClassName(this,s.Disabled)||e.DomUtils.hasClassName(this,s.ReadOnly))return;const r=G.getDateFromTarget(t.detail.source.target);if(!r)return;this.daySelectionRenderer=this.createDaySelectionRenderer(r,!t.detail.isLongTap&&(!(t.detail.source.ctrlKey||t.detail.source.metaKey)||t.detail.isTouch)),this.addDayCellEventSubscriptions(),t.stopPropagation()}onStopDaySelection(e){this.daySelectionRenderer&&(this.daySelectionRenderer.pointerUpDate=G.getDateFromTarget(e.detail.source.target),this.daySelectionRenderer.stop(),this.raiseSelectionChanged(),this.removeDayCellEventSubscriptions(),this.daySelectionRenderer=null,e.stopPropagation())}onCancelDaySelection(e){this.daySelectionRenderer&&(this.daySelectionRenderer.cancel(),this.removeDayCellEventSubscriptions(),this.daySelectionRenderer=null,e.stopPropagation())}raiseSelectionChanged(){this.daySelectionRenderer&&this.daySelectionRenderer.isValid&&this.invokeDayCellPointerUp(this.daySelectionRenderer.pointerDownDate,this.daySelectionRenderer.pointerUpDate,this.daySelectionRenderer.clearSelection)}invokeDayCellPointerUp(e,t,s){this.dispatchEvent(new N(e,t,s))}onDayCellPointerEnter(e){if(!this.daySelectionRenderer)return;const t=G.getDateFromTarget(e.target);this.daySelectionRenderer.pointerUpDate=t}createDaySelectionRenderer(e,t){return this.enableMultiSelect?new E({pointerDownDate:e,clearSelection:t,dayCellElements:this.findDayCellElements()}):new T(e,t)}findDayCellElements(){return this.querySelectorAll(`.${f.Day}`)}getMainElement(){return this.querySelector(`.${f.MainElement}`)}getHeaderElement(){return this.querySelector(`.${f.Header}`)}getTableElement(){return this.querySelector(`.${f.Content} > table`)}getFooterElement(){return this.querySelector(`.${f.Footer}`)}initializeKeyboardNavigator(){this.keyboardNavigator=this.querySelector(D),this.keyboardNavigator&&!this.keyboardNavigator.initialized&&this.keyboardNavigator.initialize(this,new k(this))}getKeyboardNavigator(){return this.keyboardNavigator}tryMoveFocus(e,t,s){const r=this._focusStrategies[this.currentView],n=r.tryMoveFocus(e,t,s);return n&&this.tryFocusCellElement(r.getUpdatedElementToFocus()),n}static getDateRelativeTo(e,t,s){const r=G.getDateFromCell(s),n=new Date(r);return new Date(n.setDate(n.getDate()+e*(t?1:7)))}tryFocusCellElement(e){null!==e&&(this.focusedCellElement=e)}restoreFocus(){const e=this._focusStrategies[this.currentView].getUpdatedElementToFocus();this.tryFocusCellElement(e),this.tryFireFocusedDayChanged()}onFocusedDayChanged(e){this.focusedDayChangedHandlers.push(e)}tryFireFocusedDayChanged(){if(null!==this.focusedCellElement)for(const e of this.focusedDayChangedHandlers)e(this.focusedCellElement)}static getDateFromTarget(e){const t=G.getDayCellByTarget(e);return t?G.getDateFromCell(t):null}static getDayCellByTarget(t){const s=t;return s?e.DomUtils.hasClassName(s,f.Day)?s:s.closest(`.${f.Day}`):null}static getDateFromCell(e){return new Date(Number(e.getAttribute(C.dataDate)))}static getMonthFromCell(e){const t=e.getAttribute(C.dataMonth);if(t)return P[t]}static getYearFromCell(e){const t=e.getAttribute(C.dataYear);if(t)return Number(t)}static getDecadeFromCell(e){const t=e.getAttribute(C.dataDecade);if(!t)return;const[s,r]=t.split("-").map(Number);return{startYear:s,endYear:r}}static getMonthOffsetInDaysFrom(e,t){const s=G.getDateFromCell(t);let r=new Date(s);return r=new Date(r.setMonth(r.getMonth()+e)),Math.abs(r.getTime()-s.getTime())/S}static getYearOffsetInDaysFrom(e,t){const s=G.getDateFromCell(t);let r=new Date(s);return r=new Date(r.setFullYear(r.getFullYear()+e)),Math.abs(r.getTime()-s.getTime())/S}getContentTemplate(){return W}static get observedAttributes(){return[v.class,v.enableMultiSelect]}attributeChangedCallback(e,t,s){switch(e){case v.class:this.fixCalendarTableSize();break;case v.enableMultiSelect:this.enableMultiSelect=null!==s}}}customElements.define(h,G),customElements.define(I,B);const Q={loadModule:function(){}};export{G as DxCalendar,Q as default};
