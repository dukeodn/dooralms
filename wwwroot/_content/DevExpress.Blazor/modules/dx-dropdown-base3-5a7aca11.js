import{_ as e}from"./_tslib-6e8ca86b.js";import{P as o}from"./dx-html-element-pointer-events-helper-e822ee39.js";import{E as n}from"./eventhelper-8570b930.js";import{C as t}from"./custom-events-helper-e7f279d3.js";import{d as r}from"./constants-a68d01b4.js";import{P as s}from"./portal-701320f3.js";import{o as i,q as l}from"./popup-b93ffcba.js";import{d,e as p,f as a}from"./logicaltreehelper-60b7eecb.js";import{C as D}from"./css-classes-f3f8ed66.js";import{DxMaskedInputEditor as h}from"./masked-input-fb999e42.js";import{s as u}from"./lit-element-70cf14f4.js";import{e as m}from"./property-d3853089.js";class c extends Event{constructor(){super(c.eventName,{bubbles:!0,composed:!0,cancelable:!0})}}c.eventName=r+".opendropdown";class w extends Event{constructor(){super(w.eventName,{bubbles:!0,composed:!0,cancelable:!0})}}w.eventName=r+".closedropdown",t.register(c.eventName,(e=>e.detail)),t.register(w.eventName,(e=>e.detail));class E{constructor(e){this.boundOnDropDownElementChangedHandler=this.onDropDownElementChanged.bind(this),this.boundOnDropDownShownHandler=this.onDropDownShown.bind(this),this.boundOnDropDownClosedHandler=this.onDropDownClosed.bind(this),this.boundOnDropDownPortalElementsChangedHandler=this.onDropDownPortalElementsChanged.bind(this),this.control=e,this.dropDownPortal=null,this._dropDownElement=null,this._adaptiveDropDownElement=null}get dropDownElement(){return this._dropDownElement}get useMobileFocusBehaviour(){var e;return(null===(e=this._adaptiveDropDownElement)||void 0===e?void 0:e.adaptivityEnabled)||!1}onConnectedCallback(){this.ensureDropDownInfrastructure(),this.control.addEventListener(s.eventName,this.boundOnDropDownElementChangedHandler)}onDisconnectedCallback(){this.control.removeEventListener(s.eventName,this.boundOnDropDownElementChangedHandler),this.disposeDropDownInfrastructure()}onSlotChanged(){this.disposeDropDownInfrastructure(),this.ensureDropDownInfrastructure()}getDropDownPortal(){if(!this.control.shadowRoot)return null;const e=this.control.shadowRoot.querySelector("slot");if(!e)return null;return e.assignedNodes().find((e=>d(e)))}onDropDownElementChanged(e){n.getOriginalSource(e)===this.dropDownPortal&&(this.disposeDropDownElement(),this.ensureDropDownElement())}onDropDownShown(e){this.dropDownElement&&p(this.dropDownElement)&&this.control.addLogicalChild(this.dropDownElement)}onDropDownClosed(e){this.dropDownElement&&p(this.dropDownElement)&&this.control.removeLogicalChild(this.dropDownElement)}onDropDownPortalElementsChanged(e){this.ensureDropDownElement()}ensureDropDownInfrastructure(){var e;this.dropDownPortal=this.getDropDownPortal(),null===(e=this.dropDownPortal)||void 0===e||e.addEventListener(s.eventName,this.boundOnDropDownPortalElementsChangedHandler),this.ensureDropDownElement()}ensureDropDownElement(){var e,o,n;this.dropDownPortal&&(this._dropDownElement=null===(e=this.dropDownPortal)||void 0===e?void 0:e.popup,null===(o=this._dropDownElement)||void 0===o||o.addEventListener(i.eventName,this.boundOnDropDownShownHandler),null===(n=this._dropDownElement)||void 0===n||n.addEventListener(l.eventName,this.boundOnDropDownClosedHandler),this._dropDownElement&&a(this._dropDownElement)&&(this._adaptiveDropDownElement=this._dropDownElement),this.control.ensureDropDownElement())}disposeDropDownInfrastructure(){var e;null===(e=this.dropDownPortal)||void 0===e||e.removeEventListener(s.eventName,this.boundOnDropDownPortalElementsChangedHandler),this.dropDownPortal=null,this._adaptiveDropDownElement=null,this.disposeDropDownElement()}disposeDropDownElement(){var e,o;null===(e=this._dropDownElement)||void 0===e||e.removeEventListener(i.eventName,this.boundOnDropDownShownHandler),null===(o=this._dropDownElement)||void 0===o||o.removeEventListener(l.eventName,this.boundOnDropDownClosedHandler),this._dropDownElement=null,this.control.disposeDropDownElement()}}class v{}v.DropDownButton=D.Prefix+"-edit-btn-dropdown";class b extends h{constructor(){super(),this.isDropDownOpen=!1,this.dropDownButtonElement=null,this.dropDownHelper=new E(this)}get useMobileFocusBehaviour(){return this.dropDownHelper.useMobileFocusBehaviour}get dropDownElement(){return this.dropDownHelper.dropDownElement}get shouldProcessFocusOut(){return!0}connectedCallback(){super.connectedCallback(),this.dropDownHelper.onConnectedCallback()}disconnectedCallback(){this.dropDownHelper.onDisconnectedCallback(),super.disconnectedCallback()}contentChanged(){super.contentChanged(),this.dropDownHelper.onSlotChanged(),this.dropDownButtonElement=this.querySelector(`.${v.DropDownButton}`),p(this.editBoxElement)&&this.addLogicalChild(this.editBoxElement)}processKeyDown(e){return this.isDropDownOpen||this.processKeyDownServerCommand(e),super.processKeyDown(e)}processFocusOut(e){var o,t,r;const s=n.getEventSource(e);if(null===(o=this.dropDownElement)||void 0===o?void 0:o.contains(s))return;const i=null!==(t=e.relatedTarget)&&void 0!==t?t:document.activeElement;if(this.contains(i)||(null===(r=this.dropDownElement)||void 0===r?void 0:r.contains(i)))return;this.raiseFocusOut(this.fieldElement?this.fieldElementValue:this.fieldText)}processFocusIn(){this.focused&&super.processFocusIn()}processPointerDown(e){var o;return n.containsInComposedPath(e,b.isDropDownButtonElement)&&(this.toggleDropDownVisibility(),this.focused||(this.shouldApplySelectionOnFocus=!1,null===(o=this.editBoxElement)||void 0===o||o.focus(),this.shouldApplySelectionOnFocus=!0),n.markHandled(e)),super.processPointerDown(e)}canHandlePointerDown(e){return o.containsInComposedPath(e,this.dropDownButtonElement)||o.containsInComposedPath(e,this.inputElement)}processKeyDownServerCommand(e){return!!b.isToggleDropDownVisibilityKeyCommand(e)&&(this.toggleDropDownVisibility(),!0)}ensureDropDownElement(){}disposeDropDownElement(){}toggleDropDownVisibility(){this.isDropDownOpen?this.dispatchEvent(new w):this.enabled&&!this.isReadOnly&&this.dispatchEvent(new c)}static isToggleDropDownVisibilityKeyCommand(e){return(e.altKey||e.metaKey)&&("ArrowUp"===e.key||"ArrowDown"===e.key)}static isDropDownButtonElement(e){var o;return!!e&&(null===(o=e.classList)||void 0===o?void 0:o.contains(v.DropDownButton))}isEditBoxElement(e){return e===this.fieldElement||e===this.editBoxTemplateElement}processCapturedKeyDownAsync(e,o){return this.processKeyDownServerCommand(e)?(e.preventDefault(),o.handled=!0,Promise.resolve()):super.processCapturedKeyDownAsync(e,o)}async processCapturedPointerDownAsync(e,o){return this.canHandlePointerDown(e)?(o.handled=!0,Promise.resolve()):super.processCapturedPointerDownAsync(e,o)}}b.shadowRootOptions={...u.shadowRootOptions,delegatesFocus:!0},e([m({type:Boolean,attribute:"is-dropdown-open"})],b.prototype,"isDropDownOpen",void 0);export{b as D};
