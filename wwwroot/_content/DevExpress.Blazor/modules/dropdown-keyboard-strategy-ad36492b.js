import{k as e}from"./key-758f2153.js";import{K as t,L as s}from"./dx-keyboard-navigator-c333dad6.js";import{T as n,x as i,y as r}from"./popup-b93ffcba.js";import{b as a,e as o}from"./logicaltreehelper-60b7eecb.js";import{M as u}from"./constants-3937401e.js";import{C as d}from"./custom-events-helper-e7f279d3.js";var l;!function(e){e[e.Expand=0]="Expand",e[e.Collapse=1]="Collapse",e[e.Execute=2]="Execute"}(l||(l={}));class c extends CustomEvent{constructor(e){super(c.eventName,{detail:{action:e},bubbles:!0,composed:!1,cancelable:!0})}}c.eventName="dxbl-dropdown.action-request",d.register(c.eventName,(e=>e.detail));class h{constructor(){this._objCaptured=new n,this._objReleased=new n,this._obj=null}get subject(){return this._obj}capture(e){if(null==e)throw new Error(`Value cannot be ${e}`);null!==this._obj&&this._objReleased.tryReject(`The object ${this._obj} was not released.`),this._objReleased=new n,this._obj=e,this._objCaptured.tryResolve(e)}release(){const e=this._obj;this._obj=null,e&&this._objReleased.tryResolve(e),this._objCaptured=new n}waitCapture(){return this._objCaptured.promise}waitRelease(){return this._objReleased.promise}}function b(e){return e&&"hasPopup"in e.dataset}function m(e){return!!e&&"expanded"in e.dataset}function p(e,t){return e.classList.contains(t)}function y(e){return e.isConnected&&e.matches(":scope:focus-within")}const C=`.${u.menuItem} > .dxbl-btn, .${u.menuItem} > .dxbl-menu-item-tmpl`,g="data-keyboard-navigator-is-ready";class S extends t{initialize(){super.initialize(),this.targetElement.setAttribute(g,"")}updateSelectedItemByIndex(e){e<0&&(e=Math.min(this.selectedItemIndex,this.itemCount-1)),super.updateSelectedItemByIndex(e)}isImmediatelyClickEnabled(){return!1}canSwitchToNestedContentMode(){return!0}handleKeyDown(e){return!!super.handleKeyDown(e)||!this.nestedContentSelected&&this.handleKeyDownCore(e)}}class E extends S{constructor(e,t){super(e,t),this.boundOnPopupKeyboardStrategyCreating=this.onPopupKeyboardStrategyCreating.bind(this),this._subMenuHolder=new h,this.subscribeToEvents()}subscribeToEvents(){this.targetElement.addEventListener(i.eventName,this.boundOnPopupKeyboardStrategyCreating)}onPopupKeyboardStrategyCreating(e){e.detail.factory={create:(e,t)=>this.createPopupStrategy(e,t)}}get subMenuStrategy(){return this._subMenuHolder.subject}canSwitchToNestedContentMode(){return!this.subMenuStrategy}onSubMenuShown(e){this.tryAddLogicalChild(e.targetElement),this._subMenuHolder.capture(e)}onSubMenuClosed(e){this._subMenuHolder.subject===e&&this._subMenuHolder.release(),this.navigator.leaveDirection===s.None&&(e.targetElement.isConnected&&!y(e.targetElement)||this.focusSelectedItem()),this.tryRemoveLogicalChild(e.targetElement)}tryAddLogicalChild(e){a(this.targetElement)&&o(e)&&(e.logicalParent||this.targetElement.addLogicalChild(e))}tryRemoveLogicalChild(e){a(this.targetElement)&&o(e)&&e.logicalParent===this.targetElement&&this.targetElement.removeLogicalChild(e)}waitSubMenuShown(){return this._subMenuHolder.waitCapture()}waitSubMenuClosed(){return this._subMenuHolder.waitRelease()}}var w;!function(e){e[e.First=0]="First",e[e.Last=1]="Last"}(w||(w={}));class K extends r{initialize(){super.initialize(),this.targetElement.setAttribute(g,"")}canSwitchToNestedContentMode(){return!0}isImmediatelyClickEnabled(){return!1}updateSelectedItemByIndex(e){e<0&&(e=Math.min(this.selectedItemIndex,this.itemCount-1)),super.updateSelectedItemByIndex(e)}handleKeyDown(t){return!(e.KeyUtils.getEventKeyCode(t)===e.KeyCode.Tab&&!this.nestedContentSelected)&&(!!super.handleKeyDown(t)||!this.nestedContentSelected&&this.handleKeyDownCore(t))}focusFirstItem(){this.focusItem(0)}focusLastItem(){this.focusItem(this.itemCount-1)}focusItem(e){this.updateSelectedItemByIndex(e),this.focusSelectedItem()}doClick(e){this.selectedItemElement&&this.raiseClickEvent(this.selectedItemElement,e.ctrlKey,e.metaKey,e.shiftKey)}}class M extends K{constructor(e,t){super(e,t),this._subMenuHolder=new h,this.boundOnPopupKeyboardStrategyCreating=this.onPopupKeyboardStrategyCreating.bind(this),this.subscribeToEvents()}get subMenuStrategy(){return this._subMenuHolder.subject}canSwitchToNestedContentMode(){return!this.subMenuStrategy}handleKeyDownCore(t){switch(e.KeyUtils.getEventKeyCode(t)){case e.KeyCode.Down:return!(t.ctrlKey||t.shiftKey||t.altKey)&&(this.moveToNextItem(!0),!0);case e.KeyCode.Up:return!(t.ctrlKey||t.shiftKey||t.altKey)&&(this.moveToPrevItem(!0),!0);case e.KeyCode.Home:return this.selectItem(0),!0;case e.KeyCode.End:return this.selectItem(this.itemCount-1),!0;case e.KeyCode.Enter:case e.KeyCode.Space:return this.selectedItemElement===this.targetElement&&this.switchToNestedContent()||this.doAction(t),!0;case e.KeyCode.Right:return!(!b(this.selectedItemElement)||m(this.selectedItemElement))&&(this.openSubMenu(w.First),!0);case e.KeyCode.Left:return this.closeSelf();default:return!1}}onSubMenuClosed(e){this._subMenuHolder.subject===e&&this._subMenuHolder.release(),this.focusSelectedItem()}onSubMenuShown(e){this._subMenuHolder.capture(e)}waitSubMenuShown(){return this._subMenuHolder.waitCapture()}waitSubMenuClosed(){return this._subMenuHolder.waitRelease()}requestSubMenuOpen(){var e;null===(e=this.selectedItemElement)||void 0===e||e.dispatchEvent(new c(l.Expand))}requestSubMenuClose(){var e;null===(e=this.selectedItemElement)||void 0===e||e.dispatchEvent(new c(l.Collapse))}subscribeToEvents(){this.targetElement.addEventListener(i.eventName,this.boundOnPopupKeyboardStrategyCreating)}onPopupKeyboardStrategyCreating(e){e.detail.factory={create:(e,t)=>this.createSubMenuStrategy(e,t)}}}export{E as D,w as M,M as P,p as a,c as b,l as c,y as d,C as e,S as f,K as g,b as h,m as i};
