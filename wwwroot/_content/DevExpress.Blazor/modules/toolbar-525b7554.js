import{_ as t}from"./_tslib-6e8ca86b.js";import{d as e}from"./dom-e194973c.js";import{F as i,j as s,u as o,n as r,G as n,H as l,m as a,R as d,h}from"./dom-utils-55c8e5bb.js";import{d as u}from"./disposable-d2c2d283.js";import{P as c}from"./dx-html-element-pointer-events-helper-e822ee39.js";import{D as m,a as p}from"./dropdown-menu-keyboard-strategy-56f27357.js";import{T as y}from"./toolbar-css-classes-49bc0a53.js";import{S as b}from"./observables-589a5615.js";import{S as g}from"./single-slot-element-base-9006911a.js";import{C as v}from"./custom-events-helper-e7f279d3.js";import{a as f}from"./dx-keyboard-navigator-c333dad6.js";import{k as I}from"./key-758f2153.js";import{D as k,h as x,a as C,i as L,b as T,c as w}from"./dropdown-keyboard-strategy-ad36492b.js";import{t as M}from"./state-949f2642.js";import{e as S}from"./property-d3853089.js";import{e as E}from"./custom-element-267f9a21.js";import"./browser-d96520d8.js";import"./css-classes-f3f8ed66.js";import"./eventhelper-8570b930.js";import"./constants-58283e53.js";import"./devices-9f03a976.js";import"./dx-ui-element-cb17a135.js";import"./lit-element-base-7a85dca5.js";import"./data-qa-utils-8be7c726.js";import"./lit-element-70cf14f4.js";import"./logicaltreehelper-60b7eecb.js";import"./layouthelper-2d7ade10.js";import"./point-e4ec110e.js";import"./portal-701320f3.js";import"./constants-058ebb50.js";import"./popup-b93ffcba.js";import"./rafaction-bba7928b.js";import"./transformhelper-ebad0156.js";import"./positiontracker-983cbb37.js";import"./branch-bf06b0d2.js";import"./capturemanager-9ed681a0.js";import"./nameof-factory-64d95f5b.js";import"./focus-utils-24f244e4.js";import"./touch-abb6941f.js";import"./constants-3937401e.js";class B{constructor(t,e){this.toolbarModel=t,this.id=e,this.state="",this._isWidthCalculationLocked=!1,this.index=-1,this.adaptivePriority=0,this._width=0}getWidth(){return this.isVisible()?wt(this.getElement(),!1,It):0}getNoTextWidth(){return this.getWidth()}isVisible(){return!0}get isWidthCalculationLocked(){return this._isWidthCalculationLocked}updateState(t){this.state=t,this.updateStateCore(t)}updateStateCore(t){}lockWidthCalculation(){this._isWidthCalculationLocked=!0}unlockWidthCalculation(){this._isWidthCalculationLocked=!1}getGroupElement(){return null}reset(){}}class W extends B{constructor(t,e){var i,s,o,r,n;super(t,null!==(o=null!==(s=null===(i=e.element)||void 0===i?void 0:i.id)&&void 0!==s?s:e.id)&&void 0!==o?o:"-1"),this.item=e,this.adaptivePriority=null!==(n=null===(r=null==e?void 0:e.adaptivePriority)||void 0===r?void 0:r.value)&&void 0!==n?n:0}getElement(){return this.item.getElement()}updateStateCore(t){this.item.isDisplayed.update(t.indexOf("has-"+this.getName())>-1)}updateVisible(t){t||this.lockWidthCalculation(),this.item.updateVisible(t),t&&this.unlockWidthCalculation()}reset(){const t=this.getElement();t&&t.classList.remove(y.ToolbarHiddenItem)}}class N extends W{constructor(t,e){super(t,e)}getNoTextWidth(){return this.item.isDisplayed.value?function(t){let e=wt(t,!1,It);if(0===e)return e;if(t){const i=t.querySelector(Ct);if(i){const s=t.querySelector(Lt);e-=St(i);let o=i;for(;o=o.nextElementSibling;)!Et(o)&&Bt(o)&&o!==s&&(e-=wt(o))}}return e}(this.getElement()):0}getName(){return"item"}isVisible(){return this.item.isDisplayed.value}updateStateCore(t){const e=this.item.toolbar,i=-1===t.indexOf(y.ToolbarHasEllipsis);this.updateVisible(e.minRootItems>0?i||this.index<e.minRootItems:i)}getGroupElement(){return this.item.getGroupElement()}}class R extends W{constructor(t,e){super(t,e)}getName(){return"ellipsis"}updateStateCore(t){super.updateStateCore(t),this.updateVisible(this.item.isDisplayed.value)}reset(){this.updateVisible(!0)}}class P extends N{constructor(t,e){super(t,e),this.itemBlocks=[],this.addItem(e)}addItem(t){this.itemBlocks.push(new N(this.toolbarModel,t))}isVisible(){return this.itemBlocks.reduce((function(t,e){return t&&e.isVisible()}),!0)}getWidth(){return this.itemBlocks.reduce((function(t,e){return t+e.getWidth()}),0)}getNoTextWidth(){return this.itemBlocks.reduce((function(t,e){return t+e.getNoTextWidth()}),0)}updateVisible(t){this.itemBlocks.forEach((function(e){e.updateVisible(t)}))}tryAddItem(t){const e=this.itemBlocks[this.itemBlocks.length-1].item,i=e.groupName===t.groupName&&e.group===t.group&&e.adaptivePriority.value===t.adaptivePriority.value;return i&&this.addItem(t),i}}class A extends B{constructor(t,e,i){super(t,i),this.item=e}getName(){return"title"}getWidth(){return wt(this.getElement(),!1,It)}getElement(){return this.item.getElement()}}class H{constructor(t){this.items=[],this.isLocked=!1,this.subscriptions=[],t&&this.addRange(t)}subscribe(t){this.isLocked||t(this.getChanges(this.items,[])),this.subscriptions.push(t)}getChanges(t,e){return{addedItems:t||[],removedItems:e||[]}}forEach(t,e){this.items.forEach(t,e)}selectMany(t,e){return this.map(t,e).reduce((function(t,e){return t.concat(e)}),[])}reduce(t,e){return this.items.reduce(t,e)}map(t,e){return this.items.map(t,e)}filter(t,e){return this.items.filter(t,e)}any(){return this.count()>0}count(){return this.items.length}get(t){return this.items[t]}add(t){this.addItemCore(t)&&this.raiseChanges([t],[])}remove(t){this.removeItemCore(t)&&this.raiseChanges([],[t])}addRange(t){this.raiseChanges(t.map(this.addItemCore.bind(this)).filter((function(t){return!!t})),[])}removeRange(t){this.raiseChanges([],t.map(this.removeItemCore.bind(this)).filter((function(t){return!!t})))}addItemCore(t){return this.items.indexOf(t)>-1?null:this.items[this.items.length]=t}removeItemCore(t){const e=this.items.indexOf(t);return-1===e?null:this.items.splice(e,1)[0]}raiseChanges(t,e){const i=this.getChanges(t,e);(i.addedItems.length>0||i.removedItems.length>0)&&this.subscriptions.forEach((function(t){t(i)}))}lock(){this.isLocked=!0}unlock(){this.isLocked=!1}}class V{constructor(t){this.id=t,this._margins=void 0,this.blocks=[]}push(t){this.blocks.includes(t)||this.blocks.push(t),this.update()}toArray(){return Array.from(this.blocks)}get margins(){return this._margins||0}update(){if(!this._margins&&this.blocks.length){const t=this.blocks[0].getGroupElement();if(t){const i=e.DomUtils.getCurrentStyle(t);this._margins=e.DomUtils.pxToInt(i.marginRight)+e.DomUtils.pxToInt(i.marginLeft)}}}}class q{constructor(t,e,i){var s;this.layer=t,this.block=e,this.width=0,this._blockCollection=void 0;const o=e.getGroupElement();o&&(this._blockCollection=this.layer.getBlockCollection(o),null===(s=this._blockCollection)||void 0===s||s.push(e)),i.subscribe(e,((t,i=!1)=>{var s;null===t&&(t=null===(s=this.layer.getPrevLayer())||void 0===s?void 0:s.getActualBlocks().filter((function(t){return t.block===e}))[0].width),t!==this.width&&(this.width=null!=t?t:0,i||this.layer.requestUpdateLayoutModel())}))}get blockCollection(){return this._blockCollection||new V(null)}getMinWidth(){return this.width}getMaxWidth(t){return this.getMinWidth()}}class D extends q{getPrevLayerMinWidth(){const t=this.layer.getPrevLayer();return t?t.getActualBlocks().filter((t=>t.block===this.block))[0].getMinWidth():0}getMaxWidth(t){return t===this.layer?this.getPrevLayerMinWidth():this.getMinWidth()}}class U extends q{}class O extends q{}class j{constructor(t,e){this.widthCalculator=t,this.triggersResolver=e,this.widthSubscriber=null,this.widthCalculator=t,this.triggersResolver=e}subscribe(t,e){this.widthSubscriber=e;const s=this.widthCalculator.bind(this);this.triggersResolver(t).forEach((function(o){o.subscribe((function(){t.isWidthCalculationLocked||i((function(){e(s(t),!1)}))}),!0)})),i((function(){e(s(t),!0)}))}updateWidth(t){const e=this.widthSubscriber,s=this.widthCalculator.bind(this);i((function(){e(s(t),!0)}))}}let z;z={fullWidthItem:new j((function(t){return t.getWidth()}),Mt),fullWidthSystemItem:new j((function(t){return t.getWidth()}),(function(t){return[]})),titleItem:new j((function(t){return t.getWidth()}),(function(t){var e,i;return[null===(e=t.toolbarModel.title)||void 0===e?void 0:e.hasTitle,null===(i=t.toolbarModel.title)||void 0===i?void 0:i.text]})),noTextItem:new j((function(t){return t.getNoTextWidth()}),Mt),contextItem:function(t){return new j((function(e){return t.items.filter((function(t){return"item"===t.getName()&&t.index<e.index&&t.isVisible()})).length>=e.toolbarModel.minRootItems||!e.isVisible()?0:null}),Mt)},hiddenItem:new j((function(){return 0}),(function(){return[]}))};class _{getMin(t){return t.map((t=>t.minWidth)).reduce(((t,e)=>t+e))}getMax(t){return t.map((t=>t.maxWidth)).reduce(((t,e)=>t+e))}}class F extends _{getRange(t,e,i){return{min:this.getMin(t)+e,max:this.getMax(t)+e}}}class K extends _{getRange(t,e,i){return{min:this.getMin(t),max:this.getMax(t)+e}}}class $ extends _{constructor(){super(...arguments),this.prevLayerRangeCalculator=new K}getRange(t,e,i=[]){return{min:this.getMin(t)+e,max:this.getMax(i)+e-1}}}class G{constructor(t,e,i,s){this.name=t,this.canApply=e,this.blocks=i,this.margin=s}orderBlock(t,e){const i=this.blocks.find((e=>e.id===t));if(!i)throw new Error(`No block with id ${t} in layer with type: ${this.type}`);i.index=e,this.blocks.sort(((t,e)=>tt(t,e)))}getBlock(t){const e=this.blocks.find((e=>e.id===t));if(!e)throw new Error(`No block with id ${t} in layer with type: ${this.type}`);return e}}class X extends G{constructor(){super(...arguments),this.type=it.Default}updateBlock(t,e){const i=this.getBlock(t.id);if(0===t.width)return!1;const s=i.minWidth!==t.width||i.maxWidth!==t.width;return i.minWidth=t.width,i.maxWidth=t.width,s}}class J extends G{constructor(){super(...arguments),this.type=it.FullSequential}updateBlock(t,e){const i=this.getBlock(t.id);let s=i.maxWidth!==t.width;return i.maxWidth=t.width,i.minWidth&&(s=s||i.minWidth!==t.width,i.minWidth=t.width),e||(s=s||0!==i.minWidth,i.minWidth=0),s}}class Q extends G{constructor(){super(...arguments),this.type=it.NoText}updateBlock(t,e){const i=this.getBlock(t.id);if(0===t.width&&t.isHidden)return!1;const s=i.minWidth!==t.width||i.maxWidth!==t.width;return i.minWidth=t.width,i.maxWidth=t.width,s}}class Y extends G{constructor(){super(...arguments),this.type=it.NoTextSequential}updateBlock(t,e){const i=this.getBlock(t.id);let s=i.maxWidth!==t.width;return i.maxWidth=t.width,i.minWidth&&(s=s||i.minWidth!==t.width,i.minWidth=t.width),e||(s=s||0!==i.minWidth,i.minWidth=0),s}}class Z{constructor(){this.layers=[],this.fullLayerTypes=[it.Default,it.FullSequential],this.noTextLayerTypes=[it.NoText,it.NoTextSequential]}get isEmpty(){if(0===this.layers.length)return!0;return 0===this.layers.find((t=>t.type===it.Default)).blocks.filter((t=>!t.isEllipse&&!t.isTitle)).length}resetLayers(t){this.layers=this.convertLayers(t).map(this.toLayer)}initLayers(t){return!!this.isEmpty&&(this.resetLayers(t),!0)}convertLayers(t){return t.map((t=>{const e=t.getActualBlocks();return{name:t.stateName,canApply:t.canApply,type:t.type,blocks:Nt(e,t).sort(((t,e)=>tt(t,e))),margin:(i=e,[...new Set(i.map((t=>t.blockCollection)))].map((t=>t.margins)).reduce(((t,e)=>t+e),0))};var i}))}updateFullSizeBlock(t,e){return this.updateBlock(t,e,this.fullLayerTypes)}updateNoTextBlock(t,e){return this.updateBlock(t,e,this.noTextLayerTypes)}updateBlock(t,e,i){let s=!1;for(const o of this.layers.filter((t=>i.includes(t.type))))s=o.updateBlock(t,e)||s;return s}orderBlock(t,e){for(const i of this.layers)i.orderBlock(t,e)}updateBlockByLayer(t,e,i){return this.layers.find((t=>t.type===i)).updateBlock(t,e)}getItemsByName(t){const e=this.layers.find((e=>e.name===t));return this.getBlocks(e)}getItemsByType(t){const e=this.layers.find((e=>e.type===t));return this.getBlocks(e)}getBlocks(t){return t.blocks.filter((t=>-1!==t.index))}getBlock(t,e){const i=this.layers.find((e=>e.name===t));if(i)return i.blocks.find((t=>t.index===e))}getBlockInEveryLayer(t){return this.layers.map((t=>t.blocks)).flat().filter((e=>e.id===t))}toLayer(t){const{name:e,canApply:i,type:s,blocks:o,margin:r}={...t};switch(s){case it.Default:return new X(e,i,o,r);case it.FullSequential:return new J(e,i,o,r);case it.NoText:return new Q(e,i,o,r);case it.NoTextSequential:return new Y(e,i,o,r)}}}function tt(t,e){return t.isTitle||e.isTitle?t.index-e.index:t.isEllipse||e.isEllipse?e.index-t.index:t.adaptivePriority===e.adaptivePriority||e.isEllipse?t.index>e.index?1:-1:t.adaptivePriority-e.adaptivePriority}class et{constructor(){this._layers=[],this.checkpointsByLayers=new Map}get layers(){return this._layers.filter((t=>t.canApply))}initialize(t){var e;this._layers=t,this.checkpointsByLayers.clear();let i=0;for(const t of this.layers){const s=this.getPoints(t,i).filter((t=>0!==t)),o=s.filter((t=>this.getCheckpoints().indexOf(t)<0));this.checkpointsByLayers.set(t.type,o),i=null!==(e=s[s.length-1])&&void 0!==e?e:0}}getLayerTypeByWidth(t){for(const e of this.layers.map((t=>t.type))){if(this.checkpointsByLayers.get(e).indexOf(t)>-1)return e}return it.Default}getCheckpointPair(t){const e=this.getCheckpoints();let i=0,s=0;for(const o of e){if(o<t){s=o;break}i=o}return[i,s]}getCheckpoints(){const t=[...this.checkpointsByLayers.values()].flat();return[...new Set(t.sort(((t,e)=>t<e?1:-1)))]}getPoints(t,e=0){switch(t.type){case it.Default:return this.getConstantLayerPoints(t);case it.FullSequential:return this.getSeqPoints(t,!0,e);case it.NoText:return this.getConstantLayerPoints(t);case it.NoTextSequential:return this.getSeqPoints(t,!0,e)}return[]}getConstantLayerPoints(t){return[t.blocks.map((t=>t.fullSize)).reduce(((t,e)=>t+e),0)]}getSeqPoints(t,e,i){const s=[];let o=t.blocks.map((t=>t.fullSize)).reduce(((t,e)=>t+e),0);for(const e of t.blocks.slice().reverse()){const t=o-(e.fullSize-e.minWidth);t!==o&&e.index>-1&&(!i||t<i)&&s.push(t),o=t}return s}}var it,st,ot;!function(t){t[t.Default=0]="Default",t[t.FullSequential=1]="FullSequential",t[t.NoText=2]="NoText",t[t.NoTextSequential=3]="NoTextSequential"}(it||(it={}));class rt{constructor(t){this.onLayerApplied=t,this.layers=[],this.blockCollection=null,this.currentLayer=null,this.currentWidth=null,this.currentHeight=null,this._defaultLayer=null,this._sequentialLayer=null,this.minWidth=null,this.virtualLayout=new Z,this.layerCheckpointService=new et,this.layersCheckpoints=[],this.prevPoint=0,this.nextPoint=0,this.toolbarWidthUpdate=()=>{},this.toolbarHeightUpdate=()=>{}}initialize(t,e,i){this.blockCollection=t,this.elementContentWidthSubscription=s(e,(t=>{var e;this.currentWidth===t.width&&this.currentHeight===t.height||(null===this.currentWidth&&(null===(e=this.blockCollection)||void 0===e||e.subscribe((t=>{t.addedItems.forEach(this.addItemBlock.bind(this)),t.removedItems.forEach(this.removeItemBlock.bind(this))}))),this.getCheckpoints(),this.currentWidth=t.width,this.currentHeight&&this.currentHeight===t.height||(this.currentHeight=t.height,this.toolbarHeightUpdate(this.currentHeight)),this.minWidth||this.setMinWidth(),this.currentLayer&&!this.checkForLayoutUpdate()||(this.virtualLayout.isEmpty&&(this.virtualLayout.resetLayers(this.layers),this.getCheckpoints()),this.setCheckpoints(),this.setLayout()),i&&i(t))}))}addBlockToCollection(t){var e;null===(e=this.blockCollection)||void 0===e||e.add(t)}removeBlockToCollection(t){var e;null===(e=this.blockCollection)||void 0===e||e.remove(t)}dispose(){this.elementContentWidthSubscription&&o(this.elementContentWidthSubscription)}getLastLayer(){return this.layers[this.layers.length-1]||null}setDefaultLayer(t,e){const i=this._defaultLayer=new lt("default",t,this,e);this.layers.push(i)}setSimultaneousTransitionLayer(t,e,i){this.layers.push(new dt(t,it.NoText,e,this.getLastLayer(),i))}setSequentialTransitionLayer(t,e,i,s){const o=this._sequentialLayer=new at(t,e,i,this.getLastLayer(),s);this.layers.push(o)}addItemBlock(t){this.layers.forEach((function(e){e.addBlock(t)}))}removeItemBlock(t){this.layers.forEach((function(e){e.removeBlock(t)}))}removeItemBlocks(t){for(const e of t)this.removeItemBlock(e)}checkForLayoutUpdate(){const t=this.currentWidth;return this.nextPoint>0&&t<this.nextPoint||this.prevPoint>0&&t>this.prevPoint}updateFromVirtualLayer(t){const e=this.layers.find((e=>e.type===t.type));e.canApply=t.canApply;for(const i of e.layoutBlocks){const e=t.blocks.find((t=>t.id===i.block.id));e&&(i.width=e.minWidth)}}orderFromVirtualLayer(t){const e=this.layers.find((e=>e.type===t.type)),i=e.layoutBlocks,s=t.blocks;for(const i of e.layoutBlocks){const e=t.blocks.find((t=>t.id===i.block.id));e&&(i.block.index=e.index)}e.layoutBlocks=[...i].sort(((t,e)=>s.indexOf(s.find((e=>e.id===t.block.id)))-s.indexOf(s.find((t=>t.id===e.block.id)))))}recalculateLayout(){this.setLayout()}setCheckpoints(){[this.prevPoint,this.nextPoint]=this.layerCheckpointService.getCheckpointPair(this.currentWidth)}updateCheckpoints(t){const[e,i]=[this.prevPoint,this.nextPoint];this.resetCheckpoints();const s=this.currentWidth;t&&(e!==this.prevPoint&&s<this.prevPoint||i!==this.nextPoint&&s>this.nextPoint)&&this.setLayout()}resetCheckpoints(){this.virtualLayout.resetLayers(this.layers),this.layerCheckpointService.initialize(this.virtualLayout.layers),this.layersCheckpoints=this.layerCheckpointService.getCheckpoints(),this.setCheckpoints(),this.setMinWidth()}setLayout(){const t=this.layerCheckpointService.getLayerTypeByWidth(this.nextPoint>0&&this.currentWidth>this.nextPoint?this.nextPoint:this.prevPoint),e=this.layers.find((e=>e.type===t));this.virtualLayout.resetLayers(this.layers),this.applyLayer(e)}setMinWidth(){const t=this.getCheckpoints();this.minWidth=t[t.length-1],this.toolbarWidthUpdate()}updateLayout(){const t=this.findLayersForWidth(this.currentWidth)[0];t&&(this.applyLayer(t),this.minWidth=Math.min(...this.layers.filter((t=>t.latestRange)).map((t=>t.latestRange.min))))}getCheckpoints(){return this.layersCheckpoints.length||this.virtualLayout.isEmpty||this.resetCheckpoints(),this.layersCheckpoints}resetToDefault(){this.applyLayer(this.layers[0],!0)}applyLayer(t,e=!1){if(this.currentLayer=t,e)t.activateAndReset(this.currentWidth);else{this.virtualLayout.initLayers(this.layers);const e=this.virtualLayout.layers.find((t=>t.type===this.currentLayer.type));t.activate(this.currentWidth,e.blocks)}this.onLayerApplied&&this.onLayerApplied(t)}findLayersForWidth(t){return this.layers.filter((function(e){return e.isValidWidth(t)}))}forceUpdate(){null!==this.currentWidth&&this.updateLayout()}getMinWidth(){return this.minWidth?this.minWidth:this._sequentialLayer?this._sequentialLayer.getActualBlocks().map((t=>t.getMinWidth())).reduce(((t,e)=>t+e),0):null}}class nt{constructor(t,e,i,s,o){this.stateName=t,this.type=e,this.blockUpdaterGetter=i,this.prevLayer=s,this.canApply=o,this.nextLayer=null,this.layoutBlocks=[],this.nextLayer=null,s&&(s.nextLayer=this)}getNextLayer(){return null!=this.nextLayer?this.nextLayer.canApply?this.nextLayer:this.nextLayer.getNextLayer():null}getPrevLayer(){return null!=this.prevLayer?this.prevLayer.canApply?this.prevLayer:this.prevLayer.getPrevLayer():null}requestUpdateLayoutModel(){var t;null===(t=this.getPrevLayer())||void 0===t||t.requestUpdateLayoutModel()}getBlockCollection(t){var e;return null===(e=this.getPrevLayer())||void 0===e?void 0:e.getBlockCollection(t)}isValidWidth(t){if(!this.canApply||!t)return!1;const e=this.getRangeNew();return!this.getNextLayer()&&e.min>t||!this.getPrevLayer()&&e.max<t||e.min<=t&&e.max>=t}getRange(){const t=new Set,e=this.latestRange=this.getActualBlocks().reduce(((e,i)=>(t.add(i.blockCollection),{min:e.min+i.getMinWidth(),max:e.max+i.getMaxWidth(this)})),{min:0,max:0});return t.forEach((t=>{e.min+=t.margins,e.max+=t.margins})),e}getRangeNew(){const t=Nt(this.getActualBlocks(),this),e=this.type===it.NoText&&this.prevLayer?Nt(this.prevLayer.getActualBlocks(),this.prevLayer):[];return this.latestRange=this.rangeCalculator.getRange(t,0,e)}getActualBlocks(){const t=this.getPrevLayer();return t?t.getActualBlocks().map((t=>this.layoutBlocks.filter((function(e){return e.block===t.block}))[0]||t)):this.layoutBlocks}activate(t,e){t&&this.layoutBlocks.forEach((t=>{t.block.updateState(this.stateName)}))}addBlock(t){const e=this.blockUpdaterGetter(t);if(e){const i=this.createBlock(t,e);this.layoutBlocks.push(i)}}removeBlock(t){const e=this.layoutBlocks.find((e=>e.block.id===t));if(e){const t=this.layoutBlocks.indexOf(e);this.layoutBlocks.splice(t,1)}}activateAndReset(t){}}class lt extends nt{constructor(t,e,i,s){super(t,it.Default,e,null,s),this.layoutModel=i,this.rangeCalculator=new F,this.blockCollection=new Map}requestUpdateLayoutModel(){this.layoutModel.updateLayout()}createBlock(t,e){return new O(this,t,e)}activateAndReset(t){this.activate(t,[]),this.layoutBlocks.forEach((t=>{t.block.reset()}))}getBlockCollection(t){return this.getBlockCollectionCore(t)}getBlockCollectionCore(t){let e=this.blockCollection.get(t);return e||this.blockCollection.set(t,e=new V(t)),e}}class at extends nt{constructor(){super(...arguments),this.rangeCalculator=new K}activate(t,e){const i=this.getActualBlocks();this.getRangeNew();let s=this.latestRange.max,o=this.stateName;const r=new Map;for(let n=e.length-1;n>=0;n--){const l=e[n],a=i.find((t=>t.block.id===l.id));if(s>t){s-=l.maxWidth-l.minWidth;const e=a.blockCollection.id,i=(r.has(e)?r:r.set(e,a.blockCollection.toArray())).get(e);if(i&&i.splice(i.indexOf(a.block),1),s<=t){a.block.updateState(o);const t=this.getPrevLayer();o=t?t.stateName:"";continue}}a.block.updateState(o)}}getRange(){const t=new Set;return this.latestRange=this.getActualBlocks().reduce(((e,i)=>(t.add(i.blockCollection),{min:e.min+i.getMinWidth(),max:e.max+i.getMaxWidth(this)})),{min:0,max:0}),t.forEach((t=>{this.latestRange.max+=t.margins})),this.latestRange}createBlock(t,e){return new D(this,t,e)}}class dt extends nt{constructor(){super(...arguments),this.rangeCalculator=new $}createBlock(t,e){return new U(this,t,e)}getRange(){const t=new Set;let e=this.getActualBlocks().reduce((function(e,i){return t.add(i.blockCollection),e+i.getMinWidth()}),0);t.forEach((t=>{e+=t.margins}));const i=this.getPrevLayerRangeMax();return this.latestRange={min:e,max:i}}getPrevLayerRangeMax(){const t=this.getPrevLayer();return t?t.getRangeNew().max-1:0}}!function(t){t[t.Contained=0]="Contained",t[t.Plain=1]="Plain"}(st||(st={})),function(t){t[t.Default=0]="Default",t[t.Large=1]="Large"}(ot||(ot={}));class ht{constructor(t,e){this.element=t,this.toolbar=e,this.index=new b(-1),this.isVisible=new b(this.defaultIsVisible()),this.isVisible.subscribe((t=>{this.onIsVisibleChanged(t)}),!0)}defaultIsVisible(){return!0}getElement(){return this.element}updateVisible(t){this.isVisible.update(t)}onIsVisibleChanged(t){const e=this.getElement();e&&(t?this.show(e):this.hide(e))}show(t){t.classList.remove(y.ToolbarHiddenItem)}hide(t){t.classList.add(y.ToolbarHiddenItem)}}class ut extends ht{constructor(){super(...arguments),this.isDisplayed=new b(!0),this.text=new b(""),this.iconCssClass=new b("")}show(t){t.style.display=""}hide(t){t.style.display="none"}getGroupElement(){return null}}class ct extends ut{constructor(t,e,i){super(t,e),this.group=i,this.groupName=new b(""),this.adaptivePriority=new b(-1)}onIsVisibleChanged(t){super.onIsVisibleChanged(t),this.group.onItemVisibleChanged()}getElement(){return document.querySelector(`#${this.id}`)}getParent(){const t=this.getElement();return t&&t.parentElement?t.parentElement:null}getGroupElement(){return this.group.getElement()}}class mt extends ut{constructor(t,e){super(t,e)}defaultIsVisible(){return null}}class pt extends ht{constructor(t,e){super(t,e),this.items=[]}addItem(t){this.items.push(t)}onItemVisibleChanged(){if(0===this.items.length)return;const t=this.items.some((t=>t.isVisible.value));this.updateVisible(t)}getElement(){if(0===this.items.length)return null;const t=r(this.items[0].getElement(),Wt(kt,this.toolbar.id));return t||this.items[0].getParent()}}class yt extends ht{constructor(t,e){super(null,t),this.elementSelector=e,this.hasTitle=new b(!1),this.text=new b(""),this.text.subscribe((t=>{this.hasTitle.update(null!=t&&""!==t)}))}getElement(){return document.querySelector(this.elementSelector)}}class bt{constructor(t,e){this.element=t,this.id=e,this.items=[],this.itemMap=new Map,this.groupMap=new Map,this.canHideRootItems=!1,this.canCollapseToIcons=!1,this.minRootItems=0}}class gt{constructor(t){this.dataToolbarId=t,this.virtualElementCreator={[y.ToolbarGroup]:this.createVirtualGroup,[y.ToolbarItem]:this.createVirtualItem,[y.ToolbarPlaceholder]:this.createVirtualPlaceholder,[y.ButtonEllipsis]:this.createVirtualItem},this.toolbar=document.querySelector(`[${Tt}='${this.dataToolbarId}']`),this.buttonToolbar=this.toolbar.querySelector(`.${y.ButtonToolbar}`),this.virtualButtonToolbar=document.createElement("div"),this.copyToolbar(),this.toolbar.appendChild(this.virtualButtonToolbar)}copyToolbar(){this.virtualButtonToolbar.classList.remove(...this.virtualButtonToolbar.classList),this.virtualButtonToolbar.classList.add(y.VirtualToolbar),this.virtualButtonToolbar.classList.add(...this.buttonToolbar.classList);const t=[...this.buttonToolbar.children],e=[];for(const i of t){const t=[...i.classList].find((t=>null!=this.virtualElementCreator[t]));e.push(this.virtualElementCreator[t].bind(this,i)())}this.virtualButtonToolbar.innerHTML="",e.forEach((t=>this.virtualButtonToolbar.appendChild(t)))}getElementWidth(t){this.buttonToolbar.style.width=this.buttonToolbar.offsetWidth+"px";const i=this.virtualButtonToolbar.querySelector(`[virtual-id=${t}]`);let s=0,o=0;if(null!=i.parentElement&&i.parentElement.classList.contains(y.ToolbarGroup)){const t=e.DomUtils.getCurrentStyle(i.parentElement);i.parentElement.lastElementChild===i&&(o=e.DomUtils.pxToInt(t.marginRight)),i.parentElement.firstElementChild===i&&(s=e.DomUtils.pxToInt(t.marginLeft))}return this.buttonToolbar.style.width="",i.offsetWidth+s+o}setRenderMode(t){t==st.Plain?this.virtualButtonToolbar.classList.add(y.ButtonPlainToolbar):this.virtualButtonToolbar.classList.remove(y.ButtonPlainToolbar)}applyFullLayer(){this.applyAdaptivityState(y.ToolbarDefaultLayer)}applyNoTextLayer(){this.applyAdaptivityState(y.ToolbarNoItemText)}applyAdaptivityState(t){t.indexOf(y.ToolbarNoItemText)>-1?this.virtualButtonToolbar.classList.add(y.ToolbarNoItemText):this.virtualButtonToolbar.classList.remove(y.ToolbarNoItemText)}createVirtualGroup(t){const e=document.createElement("div");for(const i of t.attributes)e.setAttribute(i.name,i.value);for(const i of t.children)e.appendChild(this.createVirtualItem(i));return e}createVirtualItem(t){const e=document.createElement("div");for(const i of[...t.attributes].filter((t=>"id"!==t.name)))e.setAttribute(i.name,i.value);if(e.setAttribute("virtual-id",t.id),t.children.length>0)for(const i of t.children){const t=i.classList.contains(y.ToolbarItem)?this.createVirtualItem(i):this.createVirtualChild(i);e.appendChild(t)}else e.innerHTML=t.innerHTML;return e}createVirtualPlaceholder(t){const e=document.createElement("DIV");for(const i of[...t.attributes].filter((t=>"id"!==t.name)))e.setAttribute(i.name,i.value);return e.style.width=t.clientWidth+"px",e}createVirtualChild(t){const e=t.cloneNode(!0);return e.id="",e.setAttribute("virtual-id",t.id),e}}class vt{constructor(t,e,i){this.layoutModel=t,this.layoutOptions=e,this.minRootItemIds=[],this.virtualLayout=new Z,this.virtualToolbar=new gt(i),this.updateRenderMode(this.layoutOptions.renderMode),this.setMinRootItems()}updateMinRootItems(t){this.virtualLayout.resetLayers(this.layoutModel.layers);const e=this.virtualLayout.layers.find((t=>t.type===it.FullSequential)),i=this.virtualLayout.layers.find((t=>t.type===it.NoTextSequential));e.canApply=t>0;const s=this.virtualLayout.getItemsByName(this.layoutModel.currentLayer.stateName),o=this.getAffectedItemIds(s.map((t=>t.id)),this.layoutOptions.minRootItems,t);t-this.layoutOptions.minRootItems>0?(e.blocks.filter((t=>o.includes(t.id))).forEach((t=>t.minWidth=t.maxWidth)),i.blocks.filter((t=>o.includes(t.id))).forEach((t=>t.minWidth=t.maxWidth))):(e.blocks.filter((t=>o.includes(t.id))).forEach((t=>t.minWidth=0)),i.blocks.filter((t=>o.includes(t.id))).forEach((t=>t.minWidth=0))),this.layoutOptions.minRootItems=t,this.setMinRootItems(),this.layoutModel.updateFromVirtualLayer(e),this.layoutModel.updateFromVirtualLayer(i),this.layoutModel.updateCheckpoints(!0)}setMinRootItems(){if(0===this.virtualLayout.layers.length)return;const t=this.virtualLayout.layers.find((t=>t.type===it.FullSequential)).blocks.filter((t=>!t.isTitle&&!t.isEllipse));this.minRootItemIds=this.getAffectedItemIds(t.map((t=>t.id)),0,this.layoutOptions.minRootItems)}updateRenderMode(t){this.layoutOptions.renderMode=t,this.virtualToolbar.setRenderMode(this.layoutOptions.renderMode)}updateCanHideRootItems(t){if(this.refreshVirtualLayout(),this.layoutOptions.canHideRootItems===t)return;this.layoutOptions.canHideRootItems=t;const e=this.virtualLayout.layers.find((t=>t.type===it.FullSequential)),i=this.virtualLayout.layers.find((t=>t.type===it.NoTextSequential));e.canApply=this.layoutOptions.canHideRootItems&&(this.layoutOptions.minRootItems>0||!this.layoutOptions.canCollapseToIcons),i.canApply=this.layoutOptions.canHideRootItems,this.updateAllRealLayers(!0)}updateCanCollapseToIcons(t){if(this.refreshVirtualLayout(),this.layoutOptions.canCollapseToIcons===t)return;this.layoutOptions.canCollapseToIcons=t;const e=this.virtualLayout.layers.find((t=>t.type===it.NoText)),i=this.virtualLayout.layers.find((t=>t.type===it.NoTextSequential));e.canApply=this.layoutOptions.canCollapseToIcons,i.canApply=this.layoutOptions.canCollapseToIcons&&this.layoutOptions.canHideRootItems,this.updateAllRealLayers(!0)}addBlock(t){this.virtualLayout.initLayers(this.layoutModel.layers)}refreshVirtualLayout(){this.virtualLayout.resetLayers(this.layoutModel.layers),this.setMinRootItems()}removeBlocks(t){this.virtualLayout.initLayers(this.layoutModel.layers),this.refreshVirtualToolbar(),this.layoutModel.updateCheckpoints(!0)}orderBlock(t){this.virtualLayout.orderBlock(t.id,t.index),this.setMinRootItems(),this.updateAllRealLayers(!0),this.orderAllRealLayers()}updateBlockSize(t,e){this.refreshVirtualLayout(),e&&this.virtualToolbar.copyToolbar();let i=!1;var s;i=t.isTitle?this.virtualLayout.updateBlock(t,this.checkIfIsInMinRootItems(t.id),(s=it,Object.keys(s).filter((t=>Number.isNaN(Number(t)))).map((t=>s[t]))))||i:this.renderVirtualInLayers(t)||i,this.updateAllRealLayers(i)}renderVirtualInLayers(t){let e=!1;for(const i of this.virtualLayout.layers){i.type===it.NoText?this.virtualToolbar.applyNoTextLayer():this.virtualToolbar.applyFullLayer();const s=this.renderVirtualResizeModel(t);e=i.updateBlock(s,this.checkIfIsInMinRootItems(t.id))||e}return e}renderVirtualResizeModel(t){const e=this.virtualToolbar.getElementWidth(t.id);return{id:t.id,width:e,isTitle:t.isTitle,isEllipse:t.isEllipse,isHidden:t.isHidden}}getAffectedItemIds(t,e,i){const s=t.slice(0,e),o=t.slice(0,i);return i>e?o.filter((t=>!s.includes(t))):s.filter((t=>!o.includes(t)))}updateAllRealLayers(t){for(const t of this.virtualLayout.layers)this.layoutModel.updateFromVirtualLayer(t);this.layoutModel.updateCheckpoints(t)}orderAllRealLayers(){for(const t of this.virtualLayout.layers)this.layoutModel.orderFromVirtualLayer(t);this.layoutModel.updateCheckpoints(!0)}refreshVirtualToolbar(){this.virtualToolbar.copyToolbar()}checkIfIsInMinRootItems(t){return this.minRootItemIds.includes(t)}}class ft{constructor(t,e,i,s,o,r,n,l){this.id=t,this.index=e,this.adaptivePriority=i,this.minWidth=s,this.maxWidth=o,this.margin=r,this.isTitle=n,this.isEllipse=l}get fullSize(){return this.maxWidth}}const It=!1,kt="data-dxtoolbar-group-id",xt=".dxbl-btn-toolbar",Ct=".dxbl-image:not(.dxbl-toolbar-dropdown-toggle)",Lt=".dxbl-image.dxbl-toolbar-dropdown-toggle",Tt="data-dxtoolbar-id";function wt(t,i=!1,s=!1){if(!t)return 0;let o=Math.ceil(n(t)+(i?0:St(t)));if(t.parentElement&&!s){if(t.parentElement.lastElementChild===t){const i=e.DomUtils.getCurrentStyle(t.parentElement);o+=e.DomUtils.pxToInt(i.marginRight)}if(t.parentElement.firstElementChild===t){const i=e.DomUtils.getCurrentStyle(t.parentElement);o+=e.DomUtils.pxToInt(i.marginLeft)}}return o}function Mt(t){return[t.item.text,t.item.isDisplayed,t.item.iconCssClass]}function St(t){return l(t)}function Et(t){return e.DomUtils.hasClassName(t,"popout")}function Bt(t){return"absolute"!==e.DomUtils.getCurrentStyle(t).position}function Wt(t,e){return`[${t}=${e}]`}function Nt(t,e){return[...new Set(t)].map((t=>new ft(t.block.id,t.block.index,t.block.adaptivePriority,t.getMinWidth(),t.getMaxWidth(e),t.blockCollection.margins,t.block instanceof A,t.block instanceof R)))}class Rt{constructor(t){this.items=t}}class Pt extends CustomEvent{constructor(t){super(Pt.eventName,{detail:new Rt(t),bubbles:!0})}}Pt.eventName="dxbl-toolbar.update",v.register(Pt.eventName,(t=>t.detail));class At{constructor(t){this.item=null,this.item=t}}class Ht extends CustomEvent{constructor(t){super(Ht.eventName,{detail:new At(t),bubbles:!0})}}Ht.eventName="dxbl-toolbar-item.added";class Vt{constructor(t){this.id="",this.id=t}}class qt extends CustomEvent{constructor(t){super(qt.eventName,{detail:new Vt(t),bubbles:!0})}}qt.eventName="dxbl-toolbar-item.removed";class Dt{constructor(t){this.item=t}}class Ut extends CustomEvent{constructor(t){super(Ut.eventName,{detail:new Dt(t),bubbles:!0})}}Ut.eventName="dxbl-toolbar-item.update";class Ot{constructor(t,e=!1){this.size=t,this.force=e}}class jt extends CustomEvent{constructor(t,e=!1){super(jt.eventName,{detail:new Ot(t,e),bubbles:!0})}}jt.eventName="dxbl-toolbar-item.resized";class zt extends CustomEvent{constructor(t){super(zt.eventName,{detail:{visible:t},bubbles:!0})}}zt.eventName="dxbl-toolbar-item.visibility-changed";class _t{constructor(t){this.item=t}}class Ft extends CustomEvent{constructor(t){super(Ft.eventName,{detail:new _t(t),bubbles:!0,composed:!0})}}Ft.eventName="dxbl-toolbar-item.ordered";const Kt=":scope > .dxbl-btn-toolbar:not(.dxbl-virtual-toolbar)",$t=[...[".dxbl-btn:not([disabled]):not(.dxbl-toolbar-hidden-item)",".dxbl-btn-split:not([disabled]):not(.dxbl-toolbar-hidden-item) > .dxbl-btn",".dxbl-toolbar-item-tmpl"].map((t=>`${Kt} .dxbl-toolbar-item[visible] > ${t}`)),`${Kt} .dxbl-toolbar-btn-ellipsis[visible]:not([disabled]):not(.dxbl-toolbar-hidden-item) > .dxbl-btn`].join(","),Gt=[".dxbl-btn:not([disabled]):not(.dxbl-toolbar-hidden-item)",".dxbl-btn-split:not([disabled]):not(.dxbl-toolbar-hidden-item)",".dxbl-toolbar-item-tmpl"].map((t=>`.dxbl-toolbar-menu-item > ${t}`)).join(","),Xt="dxbl-btn-split-dropdown",Jt="dxbl-btn-split",Qt=`.${Jt}`;class Yt extends k{queryItems(){return this.queryItemsBySelector($t)}getShortcutContext(){return{itemIndex:this.selectedItemIndex}}handleKeyDownCore(t){switch(I.KeyUtils.getEventKeyCode(t)){case I.KeyCode.Right:return this.subMenuStrategy||this.moveToNextItem(!0),!0;case I.KeyCode.Left:return this.subMenuStrategy||this.moveToPrevItem(!0),!0;case I.KeyCode.Home:return this.selectItem(0),!0;case I.KeyCode.End:return this.selectItem(this.itemCount-1),!0;case I.KeyCode.Up:if(t.altKey){if(this.isMenuExpanded())return this.requestSubMenuClose(),!0}else if(this.subMenuStrategy)return this.subMenuStrategy.focusLastItem(),!0;return!1;case I.KeyCode.Down:if(t.altKey){if(this.hasMenu())return this.requestSubMenuOpen(),this.focusSubMenuFirstItemAsync(),!0}else if(this.subMenuStrategy)return this.subMenuStrategy.focusFirstItem(),!0;return!1;case I.KeyCode.Tab:return!this.nestedContentSelected&&(this.requestSubMenuClose(),t.shiftKey?this.leaveBackward():this.leaveForward(),!0);case I.KeyCode.Enter:case I.KeyCode.Space:return this.hasMenu()&&this.focusSubMenuFirstItemAsync(),!1;default:return!1}}hasMenu(){return x(this.selectedItemElement)||C(this.selectedItemElement,Xt)}isMenuExpanded(){return L(this.selectedItemElement)||C(this.selectedItemElement,Xt)&&L(this.selectedItemElement.closest(Qt))}async focusSubMenuFirstItemAsync(){(await this.waitSubMenuShown()).focusFirstItem()}requestSubMenuOpen(){var t;null===(t=this.selectedItemElement)||void 0===t||t.dispatchEvent(new T(w.Expand))}requestSubMenuClose(){var t;null===(t=this.selectedItemElement)||void 0===t||t.dispatchEvent(new T(w.Collapse))}createPopupStrategy(t,e){return new Zt(t,e,Gt,this)}}class Zt extends p{handleKeyDown(t){const e=I.KeyUtils.getEventKeyCode(t);if((e===I.KeyCode.Enter||e===I.KeyCode.Space)&&C(this.selectedItemElement,Jt)){const e=this.selectedItemElement.querySelector(".dxbl-dropdown-item.dxbl-btn");if(e)return this.raiseClickEvent(e,t.ctrlKey,t.metaKey,t.shiftKey),!0}return super.handleKeyDown(t)}}const te=[y.VirtualToolbarItem,y.ButtonEllipsis,y.ToolbarTitle];let ee=class extends g{constructor(){super(...arguments),this.isLoading=!0,this.isLayoutCalculated=!1,this.model=null,this._keyboardNavigator=null,this.layoutModel=null,this.minWidth=null,this.reinitRequested=!1,this.items=[],this.toolbarItemAddedHandler=this.addToolbarItem.bind(this),this.toolbarItemResizedHandler=this.resizeToolbarItem.bind(this),this.toolbarItemUpdatedHandler=this.updateToolbarItem.bind(this),this.toolbarItemVisibilityChangedHandler=this.toolbarItemVisibilityChanged.bind(this),this.toolbarItemOrderHandler=this.orderToolbarItem.bind(this),this.toolbarTitle="",this.minRootItemCount=0,this.collapseItemsToIcons=!1,this.hideRootItems=!1,this.itemSize=0,this.renderMode=st.Contained,this.itemSpacingMode=ot.Default,this.ellipsisId=null,this.layoutUpdateService=null,this.contentObserver=new MutationObserver((t=>{this.removeToolbarItems(t)}))}connectedCallback(){super.connectedCallback(),this.addEventListener(Ht.eventName,this.toolbarItemAddedHandler),this.addEventListener(jt.eventName,this.toolbarItemResizedHandler),this.addEventListener(Ut.eventName,this.toolbarItemUpdatedHandler),this.addEventListener(zt.eventName,this.toolbarItemVisibilityChangedHandler),this.addEventListener(Ft.eventName,this.toolbarItemOrderHandler),this.contentObserver.observe(this,{childList:!0,subtree:!0})}disconnectedCallback(){this.removeEventListener(Ht.eventName,this.toolbarItemAddedHandler),this.removeEventListener(jt.eventName,this.toolbarItemResizedHandler),this.removeEventListener(Ut.eventName,this.toolbarItemUpdatedHandler),this.removeEventListener(zt.eventName,this.toolbarItemVisibilityChangedHandler),this.removeEventListener(Ft.eventName,this.toolbarItemOrderHandler),this.contentObserver.disconnect(),super.disconnectedCallback()}updated(t){var e,i,s,o;super.updated(t),t.has("ellipsisId")&&this.initializeToolbar(null!=this.ellipsisId),t.has("collapseItemsToIcons")&&(null===(e=this.layoutUpdateService)||void 0===e||e.updateCanCollapseToIcons(this.collapseItemsToIcons)),t.has("hideRootItems")&&(null===(i=this.layoutUpdateService)||void 0===i||i.updateCanHideRootItems(this.hideRootItems)),t.has("minRootItemCount")&&(this.model&&(this.model.minRootItems=this.minRootItemCount),null===(s=this.layoutUpdateService)||void 0===s||s.updateMinRootItems(this.minRootItemCount)),t.has("renderMode")&&(null===(o=this.layoutUpdateService)||void 0===o||o.updateRenderMode(this.renderMode))}updateLayout(){var t;null===(t=this.layoutModel)||void 0===t||t.updateLayout()}addToolbarItem(t){var e,i,s,o;const r=t.detail.item;if(r.isEllipse)return;if(!(null===(i=null===(e=this.model)||void 0===e?void 0:e.items)||void 0===i?void 0:i.find((t=>t.id===r.id)))&&this.model){const t=this.initItem(r,!0),e=this.getItemsBlocks(this.model,[t]);null===(s=this.layoutModel)||void 0===s||s.addItemBlock(e[0])}r&&!this.items.some((t=>t.id===r.id))&&(this.items.push(r),null===(o=this.layoutUpdateService)||void 0===o||o.addBlock(r))}removeToolbarItems(t){var e,i,s,o;const r=this.getRemovedItemIds(t);if(r.length>0){this.items=[...this.items.filter((t=>!r.includes(t.id)))];for(const t of r){const s=null===(e=this.model)||void 0===e?void 0:e.items.find((e=>e.id===t));if(s&&this.model){const t=this.model.items.indexOf(s);null===(i=this.model)||void 0===i||i.items.splice(t,1)}}null===(s=this.layoutModel)||void 0===s||s.removeItemBlocks(r),null===(o=this.layoutUpdateService)||void 0===o||o.removeBlocks(r)}}resizeToolbarItem(t){this.processToolbarItem(t.detail.size,t.detail.force)}updateToolbarItem(t){this.processToolbarItem(t.detail.item)}toolbarItemVisibilityChanged(t){this.initializeKeyboardNavigator()}initializeKeyboardNavigator(){this._keyboardNavigator&&(this._keyboardNavigator.initialized?this._keyboardNavigator.reinitialize():this._keyboardNavigator.initialize(this,new Yt(this._keyboardNavigator,this)))}orderToolbarItem(t){var e;const i=t.detail.item,s=this.items.find((t=>t.id===i.id));s&&i.index!==s.index&&(s.index=i.index,null===(e=this.layoutUpdateService)||void 0===e||e.orderBlock(i))}processToolbarItem(t,e=!1){var i;if(0===this.offsetHeight)return;const s=this.items.find((e=>e.id===t.id));s&&(s.width!==t.width||e)&&(s.width=t.width,"none"!==window.getComputedStyle(this).display&&(t.isEllipse||null===(i=this.layoutUpdateService)||void 0===i||i.updateBlockSize(t,!0)))}initializeToolbar(t){const e={mainElement:this,canCollapseToIcons:this.collapseItemsToIcons,canHideRootItems:this.hideRootItems,minRootItems:this.minRootItemCount,title:this.toolbarTitle,items:this.items,itemSize:this.itemSize,renderMode:this.renderMode,itemSpacingMode:this.itemSpacingMode,adaptiveMenuModel:{id:this.ellipsisId}};t?this.reinit(e):this.init(e)}initItem(t,e=!1){const i=document.querySelector(`#${t.id}[dxbl-toolbar-adaptive-item]`);const s=this.model.groupMap;i&&i.classList.remove(y.ToolbarHiddenItem);const o=r(i,Wt(kt,this.dataset.dxtoolbarId));let n=null;s.has(o)&&(n=s.get(o)),n||(n=new pt(o,this.model),s.set(o,n));const l=new ct(i,this.model,n);return l.text.update(t.text),l.groupName.update(t.groupName),l.adaptivePriority.update(t.adaptivePriority),l.iconCssClass.update(t.iconCssClass),l.isDisplayed.update(t.visible),l.index.update(t.index),l.id=t.id,this.model.itemMap.set(l.id,l),this.model.items.every((t=>t.id!==l.id))&&(n.addItem(l),this.model.items.push(l)),l}init(t){var s;const o=t.mainElement;if(!o)return;this.isLayoutCalculated=!1;const r=o.dataset.dxtoolbarId,n=Wt("data-dxtoolbar-title-id",r),l=Wt("data-dxtoolbar-ellipsis-id",r),d=document.querySelector(l),h=this.model=new bt(o,r),u=h.groupMap;Array.from(t.items).forEach((t=>this.initItem(t))),h.canHideRootItems=t.canHideRootItems,h.canCollapseToIcons=t.canCollapseToIcons,h.minRootItems=t.minRootItems,h.itemSize=t.itemSize,h.renderMode=t.renderMode,h.itemSpacing=t.itemSpacingMode;const c=new H([]),m=new yt(h,n);m.text.update(t.title),h.title=m;const p=document.querySelector(n);c.add(new A(h,m,null!==(s=null==p?void 0:p.id)&&void 0!==s?s:"-1"));const b=Array.from(u.values()),g=b.some((t=>t))?b.map((t=>t.items)).reduce(((t,e)=>t.concat(e))):[];c.addRange(this.getItemsBlocks(h,g.filter((t=>t.element))));const v=new mt(d,h);v.id=t.adaptiveMenuModel.id,c.add(new R(h,v)),h.ellipsisViewModel=v,this._keyboardNavigator=this.querySelector(f),this.initializeKeyboardNavigator();const I=z.contextItem(c),k=this.layoutModel=new rt((t=>{if(!this.isLayoutCalculated){this.isLayoutCalculated=!0;const t=h.element;i((()=>{const e=t.querySelector(xt);this.updateControlStyles(h,Math.ceil(!this.isLoading&&e?e.offsetHeight:t.offsetHeight)),this.isLoading=!1}))}const s=h.element.querySelector(xt)||h.element;if(t.stateName.indexOf(y.ToolbarNoItemText)>-1?e.DomUtils.addClassName(s,y.ToolbarNoItemText):e.DomUtils.removeClassName(s,y.ToolbarNoItemText),e.DomUtils.removeClassName(o,y.Loading),a(o))return;const r=h.items.concat(h.ellipsisViewModel).map((t=>({Id:t.id,IsVisible:t.isVisible.value})));this.dispatchEvent(new Pt(Array.from(r)))}));k.setDefaultLayer((function(t){switch(t.getName()){case"item":return z.fullWidthItem;case"title":return z.titleItem}return z.hiddenItem}),!0),k.setSequentialTransitionLayer(y.ToolbarHasEllipsis,it.FullSequential,(function(t){switch(t.getName()){case"ellipsis":return z.fullWidthSystemItem;case"item":return I}}),h.canHideRootItems&&(h.minRootItems>0||!h.canCollapseToIcons)),k.setSimultaneousTransitionLayer(y.ToolbarNoItemText,(function(t){switch(t.getName()){case"item":return z.noTextItem;case"ellipsis":return z.hiddenItem}}),h.canCollapseToIcons),k.setSequentialTransitionLayer(h.canCollapseToIcons?`${y.ToolbarNoItemText} ${y.ToolbarHasEllipsis}`:y.ToolbarHasEllipsis,it.NoTextSequential,(function(t){switch(t.getName()){case"item":return I;case"ellipsis":return z.fullWidthSystemItem}}),h.canHideRootItems&&h.canCollapseToIcons),c.forEach((t=>t._width=t.getWidth())),k.initialize(c,h.element.querySelector(xt)||h.element,(t=>{this.height!==t.height&&(this.isLayoutCalculated=!1,this.height=t.height),this.checkUpdateMinWidth(h)})),k.toolbarWidthUpdate=()=>this.checkUpdateMinWidth(h),k.toolbarHeightUpdate=t=>{},setTimeout((()=>{this.layoutUpdateService=new vt(k,{canCollapseToIcons:this.collapseItemsToIcons,canHideRootItems:this.hideRootItems,minRootItems:this.minRootItemCount,renderMode:this.renderMode},this.getAttribute(Tt))}))}reinit(t){this.reinitRequested||(this.reinitRequested=!0,d((()=>{this.resetToDefault(),this.disposeModel(),d((()=>{this.reinitRequested=!1,this.init(t)}))})))}resetToDefault(){var t;null===(t=this.layoutModel)||void 0===t||t.resetToDefault()}updateSettings(){}oldUpdateSettings(t){var e,i;if(!this.model)return;let s=!1,o=!1;if(this.model.canHideRootItems!==t.canHideRootItems&&(this.model.canHideRootItems=t.canHideRootItems,s=!0),this.model.canCollapseToIcons!==t.canCollapseToIcons&&(this.model.canCollapseToIcons=t.canCollapseToIcons,s=!0),this.model.minRootItems!==t.minRootItems&&(this.model.minRootItems=t.minRootItems,o=!0),this.model.itemSize!==t.itemSize&&(this.model.itemSize=t.itemSize,o=!0),this.model.renderMode!==t.renderMode&&(this.model.renderMode=t.renderMode,o=!0),this.model.itemSpacing!==t.itemSpacingMode&&(this.model.itemSpacing=t.itemSpacingMode,o=!0),null===(e=this.model.title)||void 0===e||e.text.update(t.title),!o){const e=Array.from(t.items).map((t=>t.id)),i=Array.from(this.model.itemMap.values()).map((t=>t.id));o=!((r=e).length===(n=i).length&&r.every(((t,e)=>t===n[e])))}var r,n;o?this.reinit(t):(Array.from(t.items).forEach((t=>{if(!this.model)return;const e=this.model.itemMap.get(t.id);e&&(e.text.update(t.text),e.groupName.update(t.groupName),e.adaptivePriority.update(t.adaptivePriority),e.index.update(t.index),e.iconCssClass.update(t.iconCssClass),e.isDisplayed.update(t.visible))})),s&&(null===(i=this.layoutModel)||void 0===i||i.forceUpdate()))}disposeModel(){var t;null===(t=this.layoutModel)||void 0===t||t.dispose()}dispose(){this.disposeModel()}getItemsBlocks(t,e){return e.reduce(((e,i)=>e.group&&e.group.tryAddItem(i)?e:i.groupName.value?{group:e.blocks[e.blocks.length]=new P(t,i),blocks:e.blocks}:{group:null,blocks:e.blocks.concat([new N(t,i)])}),{blocks:[],group:null}).blocks.sort((function(t,e){return t.item.adaptivePriority.value-e.item.adaptivePriority.value})).map((function(t,e){return t.index=e,t}))}updateControlStyles(t,e){t.element.style.height=e+"px"}checkUpdateMinWidth(t){var e;const i=null===(e=this.layoutModel)||void 0===e?void 0:e.getMinWidth();i&&this.minWidth!==i&&(this.minWidth=i,t.element.style.minWidth=i+"px")}getRemovedItemIds(t){const e=t=>"DXBL-TOOLBAR-ITEM"===t.tagName&&!te.some((e=>t.classList.contains(e))),i=t.filter((t=>!t.target.classList.contains(y.VirtualToolbar))).map((t=>[...t.removedNodes])).flat().map((t=>t)),s=i.filter((t=>e(t))),o=i.filter((t=>(t=>"DIV"===t.tagName&&t.classList.contains(y.ToolbarGroup))(t))).map((t=>[...t.children])).flat().map((t=>t)).filter((t=>e(t)));return s.map((t=>t.id)).concat(o.map((t=>t.id)))}};t([M()],ee.prototype,"layoutModel",void 0),t([M()],ee.prototype,"items",void 0),t([S({type:String,attribute:"toolbar-title"})],ee.prototype,"toolbarTitle",void 0),t([S({type:Number,attribute:"min-root-item-count"})],ee.prototype,"minRootItemCount",void 0),t([S({type:Boolean,attribute:"auto-collapse-items-to-icons"})],ee.prototype,"collapseItemsToIcons",void 0),t([S({type:Boolean,attribute:"auto-hide-root-items"})],ee.prototype,"hideRootItems",void 0),t([S({type:Number,attribute:"item-size"})],ee.prototype,"itemSize",void 0),t([S({type:st,attribute:"render-mode"})],ee.prototype,"renderMode",void 0),t([S({type:ot,attribute:"item-spacing-mode"})],ee.prototype,"itemSpacingMode",void 0),t([S({type:String,attribute:"ellipsis-id"})],ee.prototype,"ellipsisId",void 0),ee=t([E(y.Toolbar)],ee);const ie=new Map,se=new ResizeObserver((t=>{for(const e of t){const t=e.target;t&&t.updateSize()}}));let oe=class extends g{constructor(){super(...arguments),this.text="",this.groupName="",this.adaptivePriority=0,this.iconCssClass="",this.visible=!1,this.index=0,this.currentIndex=0,this.justHidden=!1}get isEllipse(){return this.classList.contains(y.ButtonEllipsis)}get isTitle(){return this.classList.contains(y.ToolbarTitle)}get isPlaceholder(){return this.classList.contains(y.ToolbarPlaceholder)}get isHidden(){return"none"===this.style.display}update(t){t.has("text")&&this.updateSize(!0),t.has("visible")&&this.dispatchEvent(new zt(this.visible)),t.has("index")&&this.index!==this.currentIndex&&(this.currentIndex=this.index,this.itemOrdered()),super.update(t)}updateSize(t=!1){(!this.isHidden||this.justHidden||(this.justHidden=!0,t))&&(this.isHidden||!this.justHidden?this.dispatchEvent(new jt({id:this.id,width:this.offsetWidth,isTitle:this.isTitle,isEllipse:this.isEllipse,isHidden:this.isHidden},t)):this.justHidden=!1)}connectedCallback(){super.connectedCallback(),this.itemAdded(),this.isEllipse||this.isPlaceholder||se.observe(this)}disconnectedCallback(){super.disconnectedCallback(),this.dispatchEvent(new qt(this.id)),this.isEllipse||this.isPlaceholder||se.unobserve(this)}itemAdded(){this.dispatchEvent(new Ht(this.toolbarItem))}itemOrdered(){this.index>-1&&this.dispatchEvent(new Ft(this.toolbarItem))}get toolbarItem(){return{id:this.id,groupName:this.groupName,text:this.text,adaptivePriority:this.adaptivePriority,iconCssClass:this.iconCssClass,visible:this.visible,index:this.index,width:this.offsetWidth,isEllipse:this.isEllipse,isTitle:this.isTitle}}};function re(t,e){return Promise.resolve("ok")}function ne(t){return e(t=h(t),ie),Array.from(ie.keys()).forEach((t=>{a(t)&&e(t,ie)})),Promise.resolve("ok");function e(t,e){if(!t)return;const i=t.querySelector(xt);i&&u(i);const s=e.get(t);null==s||s.dispose(),e.delete(t)}}t([S({type:String,attribute:"text"})],oe.prototype,"text",void 0),t([S({type:String,attribute:"group-name"})],oe.prototype,"groupName",void 0),t([S({type:Number,attribute:"adaptive-priority"})],oe.prototype,"adaptivePriority",void 0),t([S({type:String,attribute:"icon-css-class"})],oe.prototype,"iconCssClass",void 0),t([S({type:Boolean,attribute:"visible"})],oe.prototype,"visible",void 0),t([S({type:Number,attribute:"index"})],oe.prototype,"index",void 0),oe=t([E(y.ToolbarItem)],oe),customElements.define("dxbl-toolbar-menu-item",class extends m{constructor(){super(...arguments),this.boundOnButtonClick=this.onButtonClick.bind(this)}connectedCallback(){super.connectedCallback(),this.addEventListener("click",this.boundOnButtonClick)}disconnectedCallback(){this.removeEventListener("click",this.boundOnButtonClick),super.disconnectedCallback()}canHandlePointerDown(t){return c.containsInComposedPath(t,this)}onButtonClick(t){if(null===this.getAttribute("submit-form-on-click"))return;const e=this.getAttribute("data-dxtoolbar-container-id");if(e){const t=document.querySelector(`[${Tt}=${e}]`);if(t){const e=document.createElement("input");e.type="submit",e.hidden=!0,t.appendChild(e),e.click(),t.removeChild(e)}}}});const le={init:re,dispose:ne};export{ee as ToolbarComponent,oe as ToolbarItem,le as default,ne as dispose,re as init};
